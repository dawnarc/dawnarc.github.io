<!DOCTYPE html>
<html lang="en">
  <head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4843403245883139"
     crossorigin="anonymous"></script>

<script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.145.0 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Wang Aiguo">
<meta name="keywords" content="UE4, Animation, Runtime, Procedural">
<meta name="description" content="Keywords: UE4, Animation, Runtime Procedural Programming">


<meta property="og:description" content="Keywords: UE4, Animation, Runtime Procedural Programming">
<meta property="og:type" content="article">
<meta property="og:title" content="[UE4][Animation]Runtime Procedural Programming">
<meta name="twitter:title" content="[UE4][Animation]Runtime Procedural Programming">
<meta property="og:url" content="https://dawnarc.com/2020/04/ue4animationruntime-procedural-programming/">
<meta property="twitter:url" content="https://dawnarc.com/2020/04/ue4animationruntime-procedural-programming/">
<meta property="og:site_name" content="玄冬Wong">
<meta property="og:description" content="Keywords: UE4, Animation, Runtime Procedural Programming">
<meta name="twitter:description" content="Keywords: UE4, Animation, Runtime Procedural Programming">
<meta property="og:locale" content="en">

  
    <meta property="article:published_time" content="2020-04-14T17:28:26">
  
  
    <meta property="article:modified_time" content="2025-12-19T14:46:33">
  
  
  
    
      <meta property="article:section" content="UnrealEngine4">
    
  
  
    
      <meta property="article:tag" content="UE4">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://dawnarc.com/thumbnail/beijing/thumbnail-beijing-009.jpg">
  <meta property="twitter:image" content="https://dawnarc.com/thumbnail/beijing/thumbnail-beijing-009.jpg">






    <title>[UE4][Animation]Runtime Procedural Programming</title>

    <link rel="icon" href="https://dawnarc.com/favicon.png">
    

    <link rel="canonical" href="https://dawnarc.com/2020/04/ue4animationruntime-procedural-programming/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://dawnarc.com/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    
      
        <link rel="stylesheet" href="https://dawnarc.com/cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/paraiso-light.min.css">
      
    

    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4P9RSN4PXQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4P9RSN4PXQ');
</script>
  
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://dawnarc.com/">玄冬Wong</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://dawnarc.com/#about">
    
    
    
      
    
    </a>
    
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    <div class="sidebar-profile">
        <a href="https://dawnarc.com/#about">
          
            <img class="sidebar-profile-picture" src=https://dawnarc.com/avatar.jpg alt="" />
          
        </a>
        <h4 class="sidebar-profile-name">Wang Aiguo</h4>
        <h5 class="sidebar-profile-bio">天琴殷荡紫穹，万神血染兵锋。</h5>
      </div>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/1645289/protoss" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.facebook.com/koanland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-facebook"></i>
      
      <span class="sidebar-button-desc">Facebook</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.instagram.com/dawn_arc/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-instagram"></i>
      
      <span class="sidebar-button-desc">Instagram</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.pinterest.com/wangaiguo/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-pinterest"></i>
      
      <span class="sidebar-button-desc">Pinterest</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://steamcommunity.com/id/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-steam"></i>
      
      <span class="sidebar-button-desc">Steam</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/dawn_arc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://weibo.com/koanland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-weibo"></i>
      
      <span class="sidebar-button-desc">Weibo</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      [UE4][Animation]Runtime Procedural Programming
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2020-04-14T17:28:26&#43;08:00">
        
  
  
  
  
    Tuesday, 17:28, Apr 14, 2020
  

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://dawnarc.com/categories/unrealengine4">UnrealEngine4</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
			<amp-auto-ads type="adsense"
					data-ad-client="ca-pub-4843403245883139">
			</amp-auto-ads>
            <div class="main-content-wrap">
                <ins class="adsbygoogle"
                     style="display:block;height:120px"
                     data-ad-client="ca-pub-4843403245883139"
                     data-ad-slot="2321022024"
                     data-ad-format="fluid"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
              <p>Keywords: UE4, Animation, Runtime Procedural Programming</p>
<h3 id="common">Common</h3>
<h5 id="whats-the-difference-between-component-space-and-local-space">What&rsquo;s the difference between Component Space and Local space</h5>
<ul>
<li>Local space assumes the transform of a bone to be relative to its parent bone.</li>
<li>Component space (also named Mesh Space) assumes the bone&rsquo;s transform to be relative to the SkeletalMeshComponent.</li>
</ul>
<p>Origin: <a href="https://docs.unrealengine.com/4.27/en-US/AnimatingObjects/SkeletalMeshAnimation/NodeReference/SpaceConversion/">Convert Spaces Nodes</a></p>
<h5 id="how-to-get-bone-name-list-of-skeletalmesh">How to get bone name list of SkeletalMesh</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyCharacter<span style="color:#f92672">::</span>BeginPlay()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Super<span style="color:#f92672">::</span>BeginPlay();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(USkeletalMeshComponent<span style="color:#f92672">*</span> SkMeshComp <span style="color:#f92672">=</span> GetMesh())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        TArray<span style="color:#f92672">&lt;</span>FName<span style="color:#f92672">&gt;</span> OutBoneNames;
</span></span><span style="display:flex;"><span>        SkMeshComp<span style="color:#f92672">-&gt;</span>GetBoneNames(OutBoneNames);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="how-to-extract-transform-of-bones-from-animation-sequence">How to extract transform of bones from animation sequence</h5>
<p>.Build.cs</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span>PublicDependencyModuleNames.AddRange(<span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>[] { <span style="color:#e6db74">&#34;AnimationModifiers&#34;</span> });
</span></span></code></pre></div><p>cpp source</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyCharacter<span style="color:#f92672">::</span>Tick(<span style="color:#66d9ef">float</span> DeltaTime)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Super<span style="color:#f92672">::</span>Tick(DeltaTime);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (USkeletalMeshComponent<span style="color:#f92672">*</span> SkMeshComp <span style="color:#f92672">=</span> GetMesh())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        TArray<span style="color:#f92672">&lt;</span>FName<span style="color:#f92672">&gt;</span> OutBoneNames;
</span></span><span style="display:flex;"><span>        SkMeshComp<span style="color:#f92672">-&gt;</span>GetBoneNames(OutBoneNames);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (UAnimSequence<span style="color:#f92672">*</span> AnimSeq <span style="color:#f92672">=</span> LoadObject<span style="color:#f92672">&lt;</span>UAnimSequence<span style="color:#f92672">&gt;</span>(<span style="color:#66d9ef">nullptr</span>, TEXT(<span style="color:#e6db74">&#34;AnimSequence&#39;/Game/Mannequin/Animations/ThirdPersonWalk.ThirdPersonWalk&#39;&#34;</span>)))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">float</span> FrameCost <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.f</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">30</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            AnimTime <span style="color:#f92672">+=</span> FrameCost;
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(AnimTime <span style="color:#f92672">&lt;</span> AnimSeq<span style="color:#f92672">-&gt;</span>SequenceLength)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                TArray<span style="color:#f92672">&lt;</span>FTransform<span style="color:#f92672">&gt;</span> OutPoses;
</span></span><span style="display:flex;"><span>                UAnimationBlueprintLibrary<span style="color:#f92672">::</span>GetBonePosesForTime(AnimSeq, OutBoneNames, AnimTime, true, OutPoses);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> TestIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">54</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                FName BoneName <span style="color:#f92672">=</span> OutBoneNames[TestIndex];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                FTransform Trans <span style="color:#f92672">=</span> OutPoses[TestIndex];
</span></span><span style="display:flex;"><span>                FVector Translation <span style="color:#f92672">=</span> Trans.GetTranslation();
</span></span><span style="display:flex;"><span>                FRotator Rotation <span style="color:#f92672">=</span> Trans.Rotator();
</span></span><span style="display:flex;"><span>                FVector Scale <span style="color:#f92672">=</span> Trans.GetScale3D();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                FString Text <span style="color:#f92672">=</span> FString<span style="color:#f92672">::</span>Printf(TEXT(<span style="color:#e6db74">&#34;Bone: %s Time: %f Loc: %s Rot: %s&#34;</span>), <span style="color:#f92672">*</span>BoneName.ToString(), AnimTime, <span style="color:#f92672">*</span>Translation.ToString(), <span style="color:#f92672">*</span>Rotation.ToString());
</span></span><span style="display:flex;"><span>                GEngine<span style="color:#f92672">-&gt;</span>AddOnScreenDebugMessage(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3.f</span>, FColor<span style="color:#f92672">::</span>Yellow, Text, false);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="how-to-get-user-data-which-animation-asset-was-stored">How to get user data which animation asset was stored</h5>
<p>Engine\Source\Runtime\Engine\Classes\Engine\SkeletalMesh.h</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>UPROPERTY(EditAnywhere, AdvancedDisplay, Instanced, Category<span style="color:#f92672">=</span>SkeletalMesh)
</span></span><span style="display:flex;"><span>TArray<span style="color:#f92672">&lt;</span>UAssetUserData<span style="color:#f92672">*&gt;</span> AssetUserData;
</span></span></code></pre></div><h5 id="how-to-get-bone-index-from-bone-name">How to get bone index from bone name</h5>
<p>Engine\Source\Runtime\Engine\Classes\Engine\SkeletalMesh.h</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>RefSkeleton.FindBoneIndex(BoneName);
</span></span></code></pre></div><p>Engine\Source\Runtime\Engine\Classes\Components\SkinnedMeshComponent.h</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>int32 USkinnedMeshComponent<span style="color:#f92672">::</span>GetNumBones()<span style="color:#66d9ef">const</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>int32 USkinnedMeshComponent<span style="color:#f92672">::</span>GetBoneIndex( FName BoneName) <span style="color:#66d9ef">const</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FName USkinnedMeshComponent<span style="color:#f92672">::</span>GetBoneName(int32 BoneIndex) <span style="color:#66d9ef">const</span>;
</span></span></code></pre></div><h5 id="get-animation-compactpose-transform-from-animsequence-by-current-time">Get Animation CompactPose (Transform) from AnimSequence by Current Time</h5>
<p>Engine inner (Quoted from <code>void FAnimInstanceProxy::SlotEvaluatePose()</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>FSlotEvaluationPose <span style="color:#a6e22e">NewPose</span>(EvalState.MontageWeight, AdditiveAnimType);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Bone array has to be allocated prior to calling GetPoseFromAnimTrack
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>NewPose.Pose.SetBoneContainer(<span style="color:#f92672">&amp;</span>RequiredBones);
</span></span><span style="display:flex;"><span>NewPose.Curve.InitFrom(RequiredBones);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Extract pose from Track
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>FAnimExtractContext <span style="color:#a6e22e">ExtractionContext</span>(EvalState.MontagePosition, Montage<span style="color:#f92672">-&gt;</span>HasRootMotion() <span style="color:#f92672">&amp;&amp;</span> RootMotionMode <span style="color:#f92672">!=</span> ERootMotionMode<span style="color:#f92672">::</span>NoRootMotionExtraction);
</span></span><span style="display:flex;"><span>AnimTrack<span style="color:#f92672">-&gt;</span>GetAnimationPose(NewPose.Pose, NewPose.Curve, ExtractionContext);
</span></span></code></pre></div><p>Application (Quoted from <a href="https://github.com/EpicGames/UnrealEngine/blob/fc4f05ee91856b9076491dfdb1d9de3251f3d912/Engine/Plugins/Experimental/AnimToTexture/Source/AnimToTextureEditor/Private/AnimToTextureBPLibrary.cpp#L152">AnimToTextureBPLibrary.cpp</a>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">// Set Animation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>UAnimSequence<span style="color:#f92672">*</span> AnimSequence <span style="color:#f92672">=</span> AnimSequenceInfo.AnimSequence;
</span></span><span style="display:flex;"><span>SkeletalMeshComponent<span style="color:#f92672">-&gt;</span>SetAnimation(AnimSequence);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Go To Time
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>SkeletalMeshComponent<span style="color:#f92672">-&gt;</span>SetPosition(Time);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Update SkelMesh Animation.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>SkeletalMeshComponent<span style="color:#f92672">-&gt;</span>TickAnimation(<span style="color:#ae81ff">0.f</span>, false <span style="color:#75715e">/*bNeedsValidRootMotion*/</span>);
</span></span><span style="display:flex;"><span>SkeletalMeshComponent<span style="color:#f92672">-&gt;</span>RefreshBoneTransforms(<span style="color:#66d9ef">nullptr</span> <span style="color:#75715e">/*TickFunction*/</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Get Component Space Transforms
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Note returns all transforms, including VirtualBones
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> TArray<span style="color:#f92672">&lt;</span>FTransform<span style="color:#f92672">&gt;&amp;</span> CompSpaceTransforms <span style="color:#f92672">=</span> SkeletalMeshComponent<span style="color:#f92672">-&gt;</span>GetComponentSpaceTransforms();
</span></span></code></pre></div><h3 id="api">API</h3>
<h5 id="common-api-in-animationblueprintlibrary">Common API in AnimationBlueprintLibrary</h5>
<p>Engine\Source\Editor\AnimationModifiers\Public\AnimationBlueprintLibrary.h</p>
<p>How to get bone pose:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">/** Retrieves Bone Pose data for the given Bone Names at the specified Time from the given Animation Sequence */</span>
</span></span><span style="display:flex;"><span>UFUNCTION(BlueprintPure, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AnimationBlueprintLibrary|Pose&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> GetBonePosesForTime(<span style="color:#66d9ef">const</span> UAnimSequence<span style="color:#f92672">*</span> AnimationSequence, TArray<span style="color:#f92672">&lt;</span>FName<span style="color:#f92672">&gt;</span> BoneNames, <span style="color:#66d9ef">float</span> Time, <span style="color:#66d9ef">bool</span> bExtractRootMotion, TArray<span style="color:#f92672">&lt;</span>FTransform<span style="color:#f92672">&gt;&amp;</span> Poses, <span style="color:#66d9ef">const</span> USkeletalMesh<span style="color:#f92672">*</span> PreviewMesh <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** Retrieves Bone Pose data for the given Bone Names at the specified Frame from the given Animation Sequence */</span>
</span></span><span style="display:flex;"><span>UFUNCTION(BlueprintPure, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AnimationBlueprintLibrary|Pose&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> GetBonePosesForFrame(<span style="color:#66d9ef">const</span> UAnimSequence<span style="color:#f92672">*</span> AnimationSequence, TArray<span style="color:#f92672">&lt;</span>FName<span style="color:#f92672">&gt;</span> BoneNames, int32 Frame, <span style="color:#66d9ef">bool</span> bExtractRootMotion, TArray<span style="color:#f92672">&lt;</span>FTransform<span style="color:#f92672">&gt;&amp;</span> Poses, <span style="color:#66d9ef">const</span> USkeletalMesh<span style="color:#f92672">*</span> PreviewMesh <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>);
</span></span></code></pre></div><p>How to add or remove notify to animation at run-time:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">/** Adds an Animation Notify Event to Notify track in the given Animation with the given Notify creation data */</span>
</span></span><span style="display:flex;"><span>UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AnimationBlueprintLibrary|NotifyEvents&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> UAnimNotify<span style="color:#f92672">*</span> AddAnimationNotifyEvent(UAnimSequence<span style="color:#f92672">*</span> AnimationSequence, FName NotifyTrackName, <span style="color:#66d9ef">float</span> StartTime, TSubclassOf<span style="color:#f92672">&lt;</span>UAnimNotify<span style="color:#f92672">&gt;</span> NotifyClass);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** Adds an Animation Notify State Event to Notify track in the given Animation with the given Notify State creation data */</span>
</span></span><span style="display:flex;"><span>UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AnimationBlueprintLibrary|NotifyEvents&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> UAnimNotifyState<span style="color:#f92672">*</span> AddAnimationNotifyStateEvent(UAnimSequence<span style="color:#f92672">*</span> AnimationSequence, FName NotifyTrackName, <span style="color:#66d9ef">float</span> StartTime, <span style="color:#66d9ef">float</span> Duration, TSubclassOf<span style="color:#f92672">&lt;</span>UAnimNotifyState<span style="color:#f92672">&gt;</span> NotifyStateClass);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** Adds an the specific Animation Notify to the Animation Sequence (requires Notify&#39;s outer to be the Animation Sequence) */</span>
</span></span><span style="display:flex;"><span>UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AnimationBlueprintLibrary|NotifyEvents&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> AddAnimationNotifyEventObject(UAnimSequence<span style="color:#f92672">*</span> AnimationSequence, <span style="color:#66d9ef">float</span> StartTime, UAnimNotify<span style="color:#f92672">*</span> Notify, FName NotifyTrackName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** Adds an the specific Animation Notify State to the Animation Sequence (requires Notify State&#39;s outer to be the Animation Sequence) */</span>
</span></span><span style="display:flex;"><span>UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AnimationBlueprintLibrary|NotifyEvents&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> AddAnimationNotifyStateEventObject(UAnimSequence<span style="color:#f92672">*</span> AnimationSequence, <span style="color:#66d9ef">float</span> StartTime, <span style="color:#66d9ef">float</span> Duration, UAnimNotifyState<span style="color:#f92672">*</span> NotifyState, FName NotifyTrackName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** Removes Animation Notify Events found by Name within the Animation Sequence, and returns the number of removed name instances */</span>
</span></span><span style="display:flex;"><span>UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AnimationBlueprintLibrary|NotifyEvents&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> int32 RemoveAnimationNotifyEventsByName(UAnimSequence<span style="color:#f92672">*</span> AnimationSequence, FName NotifyName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** Removes Animation Notify Events found by Track within the Animation Sequence, and returns the number of removed name instances */</span>
</span></span><span style="display:flex;"><span>UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AnimationBlueprintLibrary|NotifyEvents&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> int32 RemoveAnimationNotifyEventsByTrack(UAnimSequence<span style="color:#f92672">*</span> AnimationSequence, FName NotifyTrackName);    
</span></span></code></pre></div><h5 id="common-api-in-bonepose">Common API in BonePose</h5>
<p>Engine\Source\Runtime\Engine\Public\BonePose.h</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">// Populate InOutPose based on raw animation data. 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BuildPoseFromRawData</span>(<span style="color:#66d9ef">const</span> TArray<span style="color:#f92672">&lt;</span>FRawAnimSequenceTrack<span style="color:#f92672">&gt;&amp;</span> InAnimationData, <span style="color:#66d9ef">const</span> TArray<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">FTrackToSkeletonMap</span><span style="color:#f92672">&gt;&amp;</span> TrackToSkeletonMapTable, FCompactPose<span style="color:#f92672">&amp;</span> InOutPose, <span style="color:#66d9ef">float</span> InTime, EAnimInterpolationType Interpolation, int32 NumFrames, <span style="color:#66d9ef">float</span> SequenceLength, FName RetargetSource);
</span></span></code></pre></div><h5 id="common-api-in-animinstance">Common API in AnimInstance</h5>
<p>Engine\Source\Runtime\Engine\Classes\Animation\AnimInstance.h</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">// the below functions are the native overrides for each phase
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Native initialization override point
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">NativeInitializeAnimation</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Native update override point. It is usually a good idea to simply gather data in this step and 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// for the bulk of the work to be done in NativeUpdateAnimation.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">NativeUpdateAnimation</span>(<span style="color:#66d9ef">float</span> DeltaSeconds);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Native Post Evaluate override point
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">NativePostEvaluateAnimation</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Native Uninitialize override point
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">NativeUninitializeAnimation</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Executed when begin play is called on the owning component
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">NativeBeginPlay</span>();
</span></span></code></pre></div><h5 id="common-api-in-animmontage">Common API in AnimMontage</h5>
<p>Tick function on animation simulatiing:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">/** Simulate is same as Advance, but without calling any events or touching any of the instance data. So it performs a simulation of advancing the timeline. */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">SimulateAdvance</span>(<span style="color:#66d9ef">float</span> DeltaTime, <span style="color:#66d9ef">float</span><span style="color:#f92672">&amp;</span> InOutPosition, <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">FRootMotionMovementParams</span> <span style="color:#f92672">&amp;</span> OutRootMotionParams) <span style="color:#66d9ef">const</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Advance</span>(<span style="color:#66d9ef">float</span> DeltaTime, <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">FRootMotionMovementParams</span> <span style="color:#f92672">*</span> OutRootMotionParams, <span style="color:#66d9ef">bool</span> bBlendRootMotion);
</span></span></code></pre></div><h5 id="animationeditorpreviewactor">AnimationEditorPreviewActor</h5>
<p>Path:<br>
Engine\Source\Editor\Persona\Public\AnimationEditorPreviewActor.h</p>
<p><code>AnimationEditorPreviewActor</code> is an Actor used to preview <code>AnimSequence</code>.<br>
Example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> UMyAnimNotify<span style="color:#f92672">::</span>Notify(USkeletalMeshComponent<span style="color:#f92672">*</span> MeshComp, UAnimSequenceBase<span style="color:#f92672">*</span> Animation)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(AActor<span style="color:#f92672">*</span> Actor <span style="color:#f92672">=</span> MeshComp<span style="color:#f92672">-&gt;</span>GetOwner())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(GIsEditor)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            AAnimationEditorPreviewActor<span style="color:#f92672">*</span> PrevActor <span style="color:#f92672">=</span> Cast<span style="color:#f92672">&lt;</span>AAnimationEditorPreviewActor<span style="color:#f92672">&gt;</span>(Actor);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            AMyCharacter<span style="color:#f92672">*</span> Character <span style="color:#f92672">=</span> Cast<span style="color:#f92672">&lt;</span>AMyCharacter<span style="color:#f92672">&gt;</span>(Actor);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Build.cs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>PublicDependencyModuleNames.Add(<span style="color:#e6db74">&#34;Persona&#34;</span>);
</span></span></code></pre></div><h3 id="engine-source-analytics">Engine Source Analytics</h3>
<h5 id="callstack-on-fanimnode_skeletalcontrolbaseevaluateskeletalcontrol_anythread">Callstack on <code>FAnimNode_SkeletalControlBase::EvaluateSkeletalControl_AnyThread()</code></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Text" data-lang="Text"><span style="display:flex;"><span>UE4Editor-CustomAnimNode-Win64-DebugGame.dll!FAnimNode_SpeedWarping::EvaluateSkeletalControl_AnyThread(FComponentSpacePoseContext &amp; Output, TArray&lt;FBoneTransform,TSizedDefaultAllocator&lt;32&gt;&gt; &amp; OutBoneTransforms) Line 32    C++
</span></span><span style="display:flex;"><span>UE4Editor-AnimGraphRuntime.dll!FAnimNode_SkeletalControlBase::EvaluateComponentSpace_AnyThread(FComponentSpacePoseContext &amp; Output) Line 165    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!FComponentSpacePoseLink::EvaluateComponentSpace(FComponentSpacePoseContext &amp; Output) Line 443    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!FAnimNode_ConvertComponentToLocalSpace::Evaluate_AnyThread(FPoseContext &amp; Output) Line 34    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!FPoseLink::Evaluate(FPoseContext &amp; Output) Line 381    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!FAnimInstanceProxy::EvaluateAnimationNode_WithRoot(FPoseContext &amp; Output, FAnimNode_Base * InRootNode) Line 1365    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!FAnimInstanceProxy::EvaluateAnimation_WithRoot(FPoseContext &amp; Output, FAnimNode_Base * InRootNode) Line 1298    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!UAnimInstance::ParallelEvaluateAnimation(bool bForceRefPose, const USkeletalMesh * InSkeletalMesh, FBlendedHeapCurve &amp; OutCurve, FCompactPose &amp; OutPose) Line 658    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!USkeletalMeshComponent::EvaluateAnimation(const USkeletalMesh * InSkeletalMesh, UAnimInstance * InAnimInstance, FVector &amp; OutRootBoneTranslation, FBlendedHeapCurve &amp; OutCurve, FCompactPose &amp; OutPose) Line 1755    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!USkeletalMeshComponent::PerformAnimationProcessing(const USkeletalMesh * InSkeletalMesh, UAnimInstance * InAnimInstance, bool bInDoEvaluation, TArray&lt;FTransform,TSizedDefaultAllocator&lt;32&gt;&gt; &amp; OutSpaceBases, TArray&lt;FTransform,TSizedDefaultAllocator&lt;32&gt;&gt; &amp; OutBoneSpaceTransforms, FVector &amp; OutRootBoneTranslation, FBlendedHeapCurve &amp; OutCurve) Line 1838    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!USkeletalMeshComponent::ParallelAnimationEvaluation() Line 3528    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!FParallelAnimationEvaluationTask::DoTask(ENamedThreads::Type CurrentThread, const TRefCountPtr&lt;FGraphEvent&gt; &amp; MyCompletionGraphEvent) Line 110    C++
</span></span><span style="display:flex;"><span>UE4Editor-Engine.dll!TGraphTask&lt;FParallelAnimationEvaluationTask&gt;::ExecuteTask(TArray&lt;FBaseGraphTask *,TSizedDefaultAllocator&lt;32&gt;&gt; &amp; NewTasks, ENamedThreads::Type CurrentThread) Line 847    C++
</span></span><span style="display:flex;"><span>[Inline Frame] UE4Editor-Core.dll!FBaseGraphTask::Execute(TArray&lt;FBaseGraphTask *,TSizedDefaultAllocator&lt;32&gt;&gt; &amp; CurrentThread, ENamedThreads::Type) Line 514    C++
</span></span><span style="display:flex;"><span>UE4Editor-Core.dll!FTaskThreadAnyThread::ProcessTasks() Line 1029    C++
</span></span><span style="display:flex;"><span>UE4Editor-Core.dll!FTaskThreadAnyThread::ProcessTasksUntilQuit(int QueueIndex) Line 855    C++
</span></span><span style="display:flex;"><span>[Inline Frame] UE4Editor-Core.dll!FTaskThreadBase::Run() Line 524    C++
</span></span><span style="display:flex;"><span>UE4Editor-Core.dll!FTaskThreadAnyThread::Run() Line 931    C++
</span></span><span style="display:flex;"><span>UE4Editor-Core.dll!FRunnableThreadWin::Run() Line 96    C++
</span></span><span style="display:flex;"><span>UE4Editor-Core.dll!FRunnableThreadWin::GuardedRun() Line 45    C++
</span></span></code></pre></div><h3 id="issues">Issues</h3>
<h5 id="animation-parallel-simulation-poses-of-character-could-not-match-if-play-two-animation-separately">Animation parallel simulation: poses of character could not match if play two animation separately</h5>
<p>Case:<br>
If character was composed by multiple skeletal mesh (e.g. one skeletal mesh is head, another skeletal mesh is arm), and thess skeletal meshes have dedicated AnimSequence asset, and these AnimSequence are in synchronized pose transform, when you play these apart animation at the same time, arm&rsquo;s pose and head&rsquo;s pose don&rsquo;t match seamlessly.</p>
<p>Caused by:<br>
Multi-thread animation simulating is on by default, and if there&rsquo;re some overhead under other work threads, then animations would not match with each other seamlessly.</p>
<p>Solution:<br>
Override <code>CanRunParallelWork</code> of <code>UAnimInstance</code>, and return <code>false</code>;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">// Can this animation instance run Update or Evaluation work in parallel
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">CanRunParallelWork</span>() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> { <span style="color:#66d9ef">return</span> false; }
</span></span></code></pre></div><p>Or set <code>bUseMultiThreadedAnimationUpdate</code> as <code>false</code>, and uncheck <code>Allow Multi Threaded Animation Update</code> in project settings.</p>
<h5 id="refresh-bone-transform-for-a-certain-frame-on-dedicated-server">Refresh bone transform for a certain frame on dedicated server</h5>
<p>If set <code>VisibilityBasedAnimTickOption</code> as <code>OnlyTickPoseWhenRendered</code> on dedicated server:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(GetMesh())
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    GetMesh()<span style="color:#f92672">-&gt;</span>VisibilityBasedAnimTickOption <span style="color:#f92672">=</span> EVisibilityBasedAnimTickOption<span style="color:#f92672">::</span>OnlyTickPoseWhenRendered;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>bone transform can&rsquo;t be update, so we can&rsquo;t get correct socket transform.<br>
Solution:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (SkelMeshComponent<span style="color:#f92672">-&gt;</span>AnimScriptInstance)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Tick the animation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    SkelMeshComponent<span style="color:#f92672">-&gt;</span>AnimScriptInstance<span style="color:#f92672">-&gt;</span>UpdateAnimation(<span style="color:#ae81ff">0.f</span>, false);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>SkelMeshComponent<span style="color:#f92672">-&gt;</span>RefreshBoneTransforms();
</span></span></code></pre></div><p>Origin: 【UE4】在 Dedicate Server 上刷新一帧骨骼 Mesh Pose<br>
<a href="https://zhuanlan.zhihu.com/p/352407350">https://zhuanlan.zhihu.com/p/352407350</a></p>
<h3 id="docs">Docs</h3>
<h5 id="offical-docs">Offical Docs</h5>
<p>Demystifying Bone Indices<br>
<a href="https://www.unrealengine.com/en-US/tech-blog/demystifying-bone-indices">https://www.unrealengine.com/en-US/tech-blog/demystifying-bone-indices</a></p>
<p>Working with Modular Characters (Skeletal Mesh Merge at runtime)<br>
<a href="https://docs.unrealengine.com/4.27/en-US/AnimatingObjects/SkeletalMeshAnimation/WorkingwithModularCharacters/">https://docs.unrealengine.com/4.27/en-US/AnimatingObjects/SkeletalMeshAnimation/WorkingwithModularCharacters/</a></p>
<p>Cloth: Making the Most of Animation Blueprints | Unreal Fest Europe 2019 (<span class="highlight-text green">Recommended</span>)<br>
<a href="https://www.youtube.com/watch?v=Oe7fYS9qxmk&amp;t=1272s">https://www.youtube.com/watch?v=Oe7fYS9qxmk&t=1272s</a></p>
<p>Motion Warping is a feature where you can dynamically adjust a character&rsquo;s root motion to align to targets.<br>
<a href="https://docs.unrealengine.com/5.0/en-US/motion-warping-in-unreal-engine/">https://docs.unrealengine.com/5.0/en-US/motion-warping-in-unreal-engine/</a></p>
<p>Skeletal Mesh Rendering Paths, different paths of Skeletal Meshes rendering (UE5)<br>
<a href="https://docs.unrealengine.com/5.3/en-US/skeletal-mesh-rendering-paths-in-unreal-engine/">https://docs.unrealengine.com/5.3/en-US/skeletal-mesh-rendering-paths-in-unreal-engine/</a></p>
<h5 id="runtime-retargeting">Runtime Retargeting</h5>
<p>Runtime Animation Retargeting<br>
<a href="https://docs.metahuman.unrealengine.com/en-US/retargeting-animations-to-a-metahuman-at-runtime/">https://docs.metahuman.unrealengine.com/en-US/retargeting-animations-to-a-metahuman-at-runtime/</a></p>
<p><a href="https://dev.epicgames.com/documentation/en-us/metahuman/animating-metahumans/retargeting-animations/runtime-retargeting">Runtime Animation Retargeting - dev.epicgames.com</a></p>
<p>UE5 Runtime Retargeting Tutorial<br>
<a href="https://www.youtube.com/watch?v=xbFOF8TY_D4">https://www.youtube.com/watch?v=xbFOF8TY_D4</a></p>
<h3 id="examples">Examples</h3>
<h5 id="examples---mocap">Examples - Mocap</h5>
<p>This plugin enables live-streaming of character animation from the Shadow motion capture system directly into UE4.<br>
<a href="https://www.unrealengine.com/marketplace/en-US/product/shadow-mocap-plugin">https://www.unrealengine.com/marketplace/en-US/product/shadow-mocap-plugin</a></p>
<h3 id="tools--plugins">Tools &amp; Plugins</h3>
<h5 id="skeletal-mesh-merge">Skeletal Mesh Merge</h5>
<p>Plugin tha merges skeletal meshes at runtime, good for procedural skeletal meshes<br>
<a href="https://github.com/Luis24989/SkeletalMeshMerger">https://github.com/Luis24989/SkeletalMeshMerger</a></p>
<p>Modular Character Plugin, A plugin that can merge skeletalmesh and duplicate morphtarget cloth assets. (<span class="highlight-text green">Recommended</span>) <br>
<a href="https://www.unrealengine.com/marketplace/en-US/product/modularcharacterplugin">https://www.unrealengine.com/marketplace/en-US/product/modularcharacterplugin</a></p>
<h3 id="control-rig-ue5">Control Rig (UE5)</h3>
<h5 id="documents---control-rig">Documents - Control Rig</h5>
<p>Using Control Rig in Unreal Engine<br>
<a href="https://www.youtube.com/watch?v=y2WzNvJZk0E">https://www.youtube.com/watch?v=y2WzNvJZk0E</a></p>
<p><a href="https://dev.epicgames.com/community/learning/courses/5vL/unreal-engine-creating-and-modifying-control-rig/vyWZ/unreal-engine-introduction-to-creating-and-modifying-control-rig">Introduction To Creating And Modifying Control Rig - Official Docs</a></p>
<p>Control Rig Editor<br>
<a href="https://docs.unrealengine.com/5.3/en-US/control-rig-editor-in-unreal-engine/">https://docs.unrealengine.com/5.3/en-US/control-rig-editor-in-unreal-engine/</a></p>
<p>How to Make Control Rigs Smart | Unreal Fest Stockholm 2025<br>
<a href="https://www.youtube.com/watch?v=7nbVJzjiPfw">https://www.youtube.com/watch?v=7nbVJzjiPfw</a></p>
<h5 id="how-to-keep-the-pose-from-the-current-frame-of-animation">How to keep the pose from the current frame of animation</h5>
<p>Check <code>Set Initial Transform From Mesh</code> in Control Rig details.
<figure><img src="https://dawnarc.com/img/2020/20200414-%5BUE4%5D%5BAnimation%5DRuntime%20Procedural%20Programming/%5BUE4%5D%5BAnimation%5DRuntime%20Procedural%20Programming%20-%2001.png">
</figure>

<div class="alert danger ">
  <p>Otherwise the skeleton was distroted when mesh play default animation sequence.</p>
</div></p>
<hr>
<p><code>I distrust official charity.All charity should be done by stealth. ― Romain Rolland</code></p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small"></span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://dawnarc.com/tags/ue4/">UE4</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2020/04/graphicsanimation-programming-notes/" data-tooltip="[Graphics]Animation Programming Notes">
              
                  <i class="fa fa-angle-left"></i>
                  
                  NEXT
                  <span class="hide-xs hide-sm text-small icon-ml"></span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2020/04/blenderself-fragements-notes/" data-tooltip="[Blender]Self Fragements Notes">
              
                  <span class="hide-xs hide-sm text-small icon-mr"></span>
                  
                  PREVIOUS
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            <script src="https://utteranc.es/client.js"
  repo="dawnarc/dawnarc.github.io"
  issue-term="pathname"
  label="Comment"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2026 Wang Aiguo. Powered by <A href="https://gohugo.io/"> Hugo</A> | Theme <A href="https://github.com/kakawait/hugo-tranquilpeak-theme/">Tranquilpeak</A>.
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2020/04/graphicsanimation-programming-notes/" data-tooltip="[Graphics]Animation Programming Notes">
              
                  <i class="fa fa-angle-left"></i>
                  
                  NEXT
                  <span class="hide-xs hide-sm text-small icon-ml"></span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2020/04/blenderself-fragements-notes/" data-tooltip="[Blender]Self Fragements Notes">
              
                  <span class="hide-xs hide-sm text-small icon-mr"></span>
                  
                  PREVIOUS
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
    
      <img id="about-card-picture" src=https://dawnarc.com/avatar.jpg alt="" />
    
    
    <h4 id="about-card-name">Wang Aiguo</h4>
    
      <div id="about-card-bio">天琴殷荡紫穹，万神血染兵锋。</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Developer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Yichang, Hubei
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('https://dawnarc.com/images/cover-v1.2.0.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

	<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/school-book.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://dawnarc.com/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
  document.querySelectorAll('pre code').forEach((el) => {
    hljs.highlightElement(el);
  });
});
</script>






    
  </body>
</html>

