<!DOCTYPE html>
<html lang="en-us">
  <head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4843403245883139"
     crossorigin="anonymous"></script>

<script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.132.2 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Wang Aiguo">
<meta name="keywords" content="UE4, Console, Command">
<meta name="description" content="Keywords: UE4, Console, Command">


<meta property="og:description" content="Keywords: UE4, Console, Command">
<meta property="og:type" content="article">
<meta property="og:title" content="[UE4]console命令行常用命令(command)">
<meta name="twitter:title" content="[UE4]console命令行常用命令(command)">
<meta property="og:url" content="https://dawnarc.com/2016/05/ue4console%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4command/">
<meta property="twitter:url" content="https://dawnarc.com/2016/05/ue4console%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4command/">
<meta property="og:site_name" content="玄冬Wong">
<meta property="og:description" content="Keywords: UE4, Console, Command">
<meta name="twitter:description" content="Keywords: UE4, Console, Command">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2016-05-27T15:30:02">
  
  
    <meta property="article:modified_time" content="2016-05-27T15:30:02">
  
  
  
    
      <meta property="article:section" content="UnrealEngine4">
    
  
  
    
      <meta property="article:tag" content="UnrealEngine4">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@dawn_arc">


  <meta name="twitter:creator" content="@dawn_arc">






  <meta property="og:image" content="https://dawnarc.com/thumbnail/beijing/thumbnail-beijing-022.jpg">
  <meta property="twitter:image" content="https://dawnarc.com/thumbnail/beijing/thumbnail-beijing-022.jpg">





  <meta property="og:image" content="https://www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=640">


    <title>[UE4]console命令行常用命令(command)</title>

    <link rel="icon" href="https://dawnarc.com/favicon.png">
    

    

    <link rel="canonical" href="https://dawnarc.com/2016/05/ue4console%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4command/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://dawnarc.com/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    
      
        <link rel="stylesheet" href="https://dawnarc.com/cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/paraiso-light.min.css">
      
    

    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4P9RSN4PXQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4P9RSN4PXQ');
</script>
  
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://dawnarc.com/">玄冬Wong</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://dawnarc.com/#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=90" alt="Author&#39;s picture" />
      
    
    </a>
    
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://dawnarc.com/#about">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Wang Aiguo</h4>
        
          <h5 class="sidebar-profile-bio">白金翰大堂经理</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/1645289/protoss" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.facebook.com/koanland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-facebook"></i>
      
      <span class="sidebar-button-desc">Facebook</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.instagram.com/dawn_arc/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-instagram"></i>
      
      <span class="sidebar-button-desc">Instagram</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/dawnarc/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
      
      <span class="sidebar-button-desc">Linkedin</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.pinterest.com/wangaiguo/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-pinterest"></i>
      
      <span class="sidebar-button-desc">Pinterest</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://steamcommunity.com/id/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-steam"></i>
      
      <span class="sidebar-button-desc">Steam</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/dawn_arc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://weibo.com/koanland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-weibo"></i>
      
      <span class="sidebar-button-desc">Weibo</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      [UE4]console命令行常用命令(command)
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2016-05-27T15:30:02&#43;08:00">
        
  
  
  
  
    Friday, 15:30, May 27, 2016
  

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://dawnarc.com/categories/unrealengine4">UnrealEngine4</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
			<amp-auto-ads type="adsense"
					data-ad-client="ca-pub-4843403245883139">
			</amp-auto-ads>
            <div class="main-content-wrap">
                <ins class="adsbygoogle"
                     style="display:block;height:120px"
                     data-ad-client="ca-pub-4843403245883139"
                     data-ad-slot="2321022024"
                     data-ad-format="fluid"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
              <p>Keywords: UE4, Console, Command</p>
<h3 id="editor命令">Editor命令</h3>
<h5 id="showflag">ShowFlag</h5>
<p>如果想在 Editor 中查看 Actor 蓝图的 Bounds（默认只能在 Static Mesh 编辑窗口中查看），可以使用 ShowFlag 命令（在编辑器窗口中按下波浪键打开输入窗口）。</p>
<p>开启：</p>
<pre><code>ShowFlag.Bounds 1
</code></pre>
<p>关闭：</p>
<pre><code>ShowFlag.Bounds 0
</code></pre>
<p>凡是 Show 命令能查看的参数，ShowFlag也能查看，包括Collision等。</p>
<div class="alert success ">
  <p>如果想在游戏运行时查看指定物体的Bounds，那么可以先执行 ShowFlag.Bounds 1，然后再以 Simulate 模式运行游戏，然后再在场景中单击要查看的物体，就可以只显示该物体的Bounds信息。</p>
</div>
<h3 id="运行时命令">运行时命令</h3>
<h5 id="camera">Camera</h5>
<p>修改Camera Mode（切换摄像机视角）：
Camera [modename]
其中modename的值为：</p>
<pre><code>static const FName NAME_Fixed = FName(TEXT(&quot;Fixed&quot;));
static const FName NAME_ThirdPerson = FName(TEXT(&quot;ThirdPerson&quot;));
static const FName NAME_FreeCam = FName(TEXT(&quot;FreeCam&quot;));
static const FName NAME_FreeCam_Default = FName(TEXT(&quot;FreeCam_Default&quot;));
static const FName NAME_FirstPerson = FName(TEXT(&quot;FirstPerson&quot;));
</code></pre>
<p>启用debug camera：</p>
<pre><code>ToggleDebugCamera
</code></pre>
<h5 id="rendering">Rendering</h5>
<p>渲染优化分析视图模式：</p>
<pre><code>//Lit view mode shows the final result of your scene once all of the Materials and lighting have been applied.
//Hotkey: Alt + 4
viewmode lit

//Unlit view mode removes all lighting from the scene, showing you Base Color only.
//Hotkey: Alt + 3
viewmode unlit

//Wireframe shows all of the polygon edges in the scene. In the case of Brushes, you will see the resultant geometry. 
//Hotkey: Alt + 2
viewmode wireframe

//Detail Lighting activates a neutral Material across the entire scene, using the normal maps of the original materials. This is useful for isolating whether your BaseColor is obscuring lighting by being too dark or noisy. 
//Hotkey: Alt + 5
viewmode lit_detaillighting

//Lighting Only shows a neutral Material that is only affected by lighting. It differs from Detail Lighting mode in that you will not see normal maps. 
//Hotkey: Alt + 6
viewmode lightingonly

//Light Complexity shows the number of non-static lights affecting your geometry. This is useful for tracking lighting cost - the more lights affecting a surface, the more expensive it will be to shade. 
//Hotkey: Alt + 7
viewmode lightcomplexity

//Shader Complexity Mode is used to visualize the number of shader instructions being used to calculate each pixel of your scene. It is generally a good indication of how performance-friendly your scene will be. In general, it is used to test overall performance for your base scene, as well as to optimize particle effects, which tend to cause performance spikes with a large amount of overdraw for a short period of time. 
//Hotkey: Alt + 8
viewmode shadercomplexity

//view quad overdraw
viewmode quadoverdraw
</code></pre>
<p>参考：View Modes<br>
<a href="https://docs.unrealengine.com/4.26/en-US/BuildingWorlds/LevelEditor/Viewports/ViewModes/">https://docs.unrealengine.com/4.26/en-US/BuildingWorlds/LevelEditor/Viewports/ViewModes/</a></p>
<p>显示 Buffer Visualization<br>
先执行（若要退出<code>Buffer Visualization</code>，执行：<code>ViewMode Lit</code>）：</p>
<pre><code>//打开所有Buffer Visualization参数的矩阵视图
ViewMode VisualizeBuffer
</code></pre>
<p>再切换到单个参数视图，比如，想查看AO（若要退出当前视图，执行：<code>r.BufferVisualizationTarget &quot;&quot;</code>）：</p>
<pre><code>r.BufferVisualizationTarget AmbientOcclusion
</code></pre>
<p>其中，<code>r.BufferVisualizationTarget</code>的可选参数包括：BaseColor, CustomDepth, CustomStencil, FinalImage, ShadingModel, MaterialAO, Metallic, Opacity, Roughness, Anisotropy, SceneColor, SceneDepth, SeparateTranslucencyRGB, SeparateTranslucencyA Specular SubsurfaceColor WorldNormal AmbientOcclusion CustomDepthWorldUnits SceneDepthWorldUnits, PreTonemapHDRColor, PostTonemapHDRColor等。</p>
<p><code>ViewMode</code>和<code>r.BufferVisualizationTarget</code>的参数，也就是Viewport左上角<code>View Mode</code>和<code>Buffer Visualization Mode</code>下的菜单名：
<figure><img src="https://dawnarc.com/img/20160527-%5BUE4%5Dconsole%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%28command%29/%5BUE4%5Dconsole%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%28command%29%20-%2001.gif">
</figure>
</p>
<p>参考：Console commands for Buffer Visualization<br>
<a href="https://answers.unrealengine.com/questions/139442/console-commands-for-buffer-visualization.html">https://answers.unrealengine.com/questions/139442/console-commands-for-buffer-visualization.html</a></p>
<p>显示刚体</p>
<pre><code>Show Collision
</code></pre>
<p>显示帧率</p>
<pre><code>stat fps
</code></pre>
<p>限制最大帧率（需要提前关闭VSync）</p>
<pre><code>t.MaxFPS 60
</code></pre>
<p>显示mesh drawcall</p>
<pre><code>stat scenerendering
</code></pre>
<p>显示UMG Widget drawcall</p>
<pre><code>stat slate
</code></pre>
<p>显示static mesh、skeletal mesh的三角面数量</p>
<pre><code>stat Engine
</code></pre>
<p>显示硬件级（RHI）三角面总数和drawcall总数，以及显存(VRAM)占用：</p>
<pre><code>stat rhi
</code></pre>
<p>其中：</p>
<ul>
<li><code>Render target memory</code>是buffer（比如g-buffer）或shadow map等render target的内存大小。buffer大小取决于分辨率，shadow map大小取决于阴影质量。</li>
<li><code>Triangles drawn</code>是最终绘制的面数，即camera frustum和occlusion culling之后的面数。数量包含了shadowmap和tessellation，所以数值会显著高于<code>stat Engine</code>中的三角面数；</li>
<li><code>DrawPrimitive calls</code>数量除了geometry，还包括decals、shadows、translucent lighting volumes、post processing等，其数值也会明显高于<code>stat scenerendering</code>中的draw call数。</li>
</ul>
<p>显示单帧信息：总时长、Game耗时、Draw耗时、GPU耗时</p>
<pre><code>stat Unit
stat UnitGraph  //附带各个参数的实时曲线图
</code></pre>
<p>显示当前帧的CPU时间信息（各种Tick, GC Mark，Update Overlaps等）：</p>
<pre><code>stat game
</code></pre>
<p>设置渲染分辨率为默认大小的50%（500就表示实际viewport大小的5倍尺寸来渲染，可以用来做压力测试，判断性能瓶颈是不是像素处理）</p>
<pre><code>r.ScreenPercentage 50
</code></pre>
<p><code>r.SetRes</code>也可以判断瓶颈是否和像素相关。和<code>r.ScreenPercentage</code>功能相同，但<code>r.ScreenPercentage</code>有额外开销。</p>
<pre><code>r.SetRes 1920x1080f
</code></pre>
<p>如果是移动端，使用<code>r.MobileContentScaleFactor</code>来控制分辨率。<code>MobileContentScaleFactor</code>减小会导致UI变模糊，解决办法是对应增大<code>ScreenPercentage</code>。</p>
<p>强制开启early Z pass：</p>
<pre><code>r.EarlyZPass 2
r.EarlyZPassOnlyMaterialMasking 1
</code></pre>
<p>默认是<code>r.EarlyZPass 3</code>，表示根据硬件特性选择性开启（比如mask材质的物体可能不开启）。<br>
EarlyZPass有没开启成功，可根据遮挡剔除有没生效来验证：</p>
<pre><code>r.visualizeOccludedPrimitives 1
</code></pre>
<p>较高drawcall情况下，开启early Z后如果basepass的overdraw明显较少，说明early Z pass效果明显。修改值后需要重新运行游戏生效。更多细节参考：<a href="https://dawnarc.com/2018/11/ue4occlusion-culling/#mask-material-only-in-early-z-pass">Mask material only in early Z-pass</a></p>
<p>设置贴图的尺寸级别（精度），<span class="highlight-text red">前提是贴图已经生成了LOD（即mipmap） </span>：</p>
<pre><code>r.mipmaplodbias 0
</code></pre>
<div class="alert warning ">
  <p>此选项对中低端移动设备的性能影响极大，因为他减小了采样贴图的大小，降低了带宽和显存访问延迟。但OpenGLES不支持，Vulkan和Metal支持。</p>
</div>
<p>特效lodbias修改命令：</p>
<pre><code>r.ParticleLODBias
</code></pre>
<p>强制以lod投射阴影：</p>
<pre><code>r.ForceLODShadow
</code></pre>
<p>关闭遮挡剔除，默认开启:</p>
<pre><code>r.AllowOcclusionQueries 0
</code></pre>
<p>运动模糊：</p>
<pre><code>//0表示禁用，1-4表示模糊级别
r.MotionBlurQuality 0
</code></pre>
<div class="alert success ">
  <p>若动作模糊默认开启，最好提供禁用开关，因为开启会增加晕3D玩家(motion sickness)的不适感。<br>
另外过度锐化（sharpness）也会让晕3D玩家不适。</p>
</div>
<p>关闭或开启屏幕上打印信息（AddOnScreenDebugMessage）</p>
<pre><code>DisableAllScreenMessages

EnableAllScreenMessages
</code></pre>
<p>Viewport高清截图（UI会被自动剔除）</p>
<pre><code>//以当前viewport分辨率的两倍进行截图
HighResShot 2

//指定分辨率截图
HighResShot 3840x2160
</code></pre>
<p>图片存储位置：<code>\Saved\Screenshots\</code></p>
<p>Taking Screenshots<br>
<a href="https://docs.unrealengine.com/en-US/Engine/Basics/Screenshots/index.html">https://docs.unrealengine.com/en-US/Engine/Basics/Screenshots/index.html</a></p>
<h5 id="dump-console-commands">Dump Console Commands</h5>
<p>Q：console的命令非常多，如何将所有命令全部dump出一个列表？<br>
A：使用命令<code>dumpconsolecommands</code>，执行后，所有可用的命令会存储在<code>\Saved\Logs\</code>下的log文件中。</p>
<p>参考自：Where can I find all the console commands?<br>
<a href="https://answers.unrealengine.com/questions/255772/where-can-i-find-all-the-console-commands.html">https://answers.unrealengine.com/questions/255772/where-can-i-find-all-the-console-commands.html</a></p>
<p>或者直接查看引擎源码：<br>
Engine\Source\Runtime\Engine\Private\UnrealEngine.cpp</p>
<pre><code>bool UEngine::Exec( UWorld* InWorld, const TCHAR* Cmd, FOutputDevice&amp; Ar )
</code></pre>
<h5 id="性能统计图工具-session-frontend">性能统计图工具 Session Frontend</h5>
<p>用于记录某段时间内的性能分析数据。</p>
<p>在需要开始统计的时刻执行：</p>
<pre><code>stat startfile
</code></pre>
<p>在统计完成的时刻执行：</p>
<pre><code>stat stopfile
</code></pre>
<p>此时会在路径 <code>Saved/Profiling/UnrealStats</code> 下生成数据文件。<br>
然后点击：Windows -》 Developer Tools -》 Session Frontend -》点击 Profiler 选项卡 -》 点击 Load 按钮，载入前面生成的数据文件。</p>
<div class="alert warning ">
  <p>性能统计自身也会消耗一定性能，有没办法将性能统计的自身消耗，从性能统计的计算结果中排除掉？答案是：No！至少目前版本不支持。</p>
</div>
<h3 id="profiling--debugging">Profiling &amp; Debugging</h3>
<h5 id="cpu">CPU</h5>
<p>CPU性能问题（耗时高、卡顿等）大多出现在GameThread、RenderThread上。</p>
<p>记录卡顿时间（通过<code>t.HitchFrameTimeThreshold</code>（单位ms，默认60。旧版本叫<code>t.HitchThreshold</code>）定义卡顿时长阀值）</p>
<pre><code>stat Hitches    //或者stat DumpHitches 记录log文件
</code></pre>
<p>程序运行时一旦某帧耗时超过<code>t.HitchFrameTimeThreshold</code>指定的时长，则函数堆栈就会被打印出来。<br>
例如，以下 hitchdump 显示LoadObject耗时较长（<code>Self</code>表示函数堆栈中上一级函数，即<code>LoadObject</code>，所占用耗时），则表示是加载资源导致顿卡</p>
<pre><code>   477.514ms (   4)  -  Thread_4118_0 - GameThread - STATGROUP_Threads - STATCAT_Advanced
     477.510ms (   2)  -  FrameTime - STAT_FrameTime - STATGROUP_Engine - STATCAT_Advanced
       470.844ms (   1)  -  FrameTime - STAT_FrameTime - STATGROUP_Engine - STATCAT_Advanced
         470.840ms (   1)  -  World Tick Time - STAT_WorldTickTime - STATGROUP_Game - STATCAT_Advanced
           470.758ms (   5)  -  Tick Time - STAT_TickTime - STATGROUP_Game - STATCAT_Advanced
             470.590ms (   2)  -  TG_PrePhysics - STAT_TG_PrePhysics - STATGROUP_TickGroups - STATCAT_Advanced
               470.585ms (   2)  -  ReleaseTickGroup Block - STAT_ReleaseTickGroup_Block - STATGROUP_TickGroups - STATCAT_Advanced
                 470.579ms (   1)  -  Game TaskGraph Tasks - STAT_TaskGraph_GameTasks - STATGROUP_Threading - STATCAT_Advanced
                   470.512ms (  20)  -  FTickFunctionTask - STATGROUP_TaskGraphTasks - STATCAT_Advanced
                     470.309ms (   1)  -  BaseGameMode/Game/Map/PVP/UEDPIE_0_PVP.PVP.PersistentLevel.BaseGameMode - STATGROUP_UObjects - STATCAT_Advanced
                       469.638ms (   3)  -  LoadObject - STAT_LoadObject - STATGROUP_Object - STATCAT_Advanced
                         377.887ms (   3)  -  Self
                         26.688ms ( 533)  -  STAT_FArchiveAsync2_WaitRead - STATGROUP_Quick - STATCAT_Advanced
</code></pre>
<p><code>stat DumpHitches</code>命令有可选参数，<code>-start</code>和<code>-stop</code>，表示dump的开始和结束位置：</p>
<pre><code>stat DumpHitches -start
stat DumpHitches -stop
</code></pre>
<p>默认只会打印GameThread、RenderThread上的卡顿，如果希望打印其他线程卡顿，比如AudioThread、TaskGraph等，执行命令：<code>t.DumpHitches.AllThreads 1</code>。</p>
<p>渲染相关的CPU性能问题还可以通过 <code>stat scenerendering</code> 、<code>stat game</code> 等命令分析，如果某类型的 draw call 数量特别高，说明这是 CPU 的瓶颈所在。</p>
<p>CPU Profiling<br>
<a href="https://docs.unrealengine.com/en-us/Engine/Performance/CPU">https://docs.unrealengine.com/en-us/Engine/Performance/CPU</a></p>
<h5 id="gpu">GPU</h5>
<p>在编辑器中运行游戏时，按下 Ctrl + Shift + 逗号，或者命令行输入：<code>profilegpu</code> ，打开 GPUProfile 面板，显示当前帧的各类计算的耗时：PostProcess、Lighting 等。<br>
注意：是当前一帧的耗时，不是平均每帧的耗时。</p>
<div class="alert warning ">
  <p>需要关闭VSync（默认是关闭），且取消最大帧率限制，否则每帧的空闲等待时长会被算到计算耗时中。</p>
</div>
<p>另外一个类似命令:<code>profilegpuhitches</code>，表示每当GPU有卡顿时，自动弹出一个当时所在帧的 GPUProfile 面板。</p>
<p>GPUProfile面板上的可视化信息，在log文件（<code>工程名\Saved\Logs\工程名.log</code>）里面也会以文本形式打印出来。<br>
在Development 打包模式下，由于无法打开GPUProfile 面板，所以分析数据只打印在log里，例如：</p>
<pre><code>Profiling the next GPU frame
LogD3D11RHI: Warning: 
LogD3D11RHI: Warning: 
LogRHI: Perf marker hierarchy, total GPU time 4.33ms
LogRHI: Warning: Profiled range was continuous.
LogRHI: 100.0% 4.33ms   FRAME 635 draws 16087 prims 18018 verts
LogRHI: 97.1% 4.20ms   Scene 633 draws 15751 prims 17346 verts
LogRHI:     1.1% 0.05ms   PrePass DDM_AllOpaque (Forced by DBuffer) 141 draws 5744 prims 5634 verts
LogRHI:        0.3% 0.01ms   BeginRenderingPrePass 1 draws 0 prims 0 verts
LogRHI:     0.5% 0.02ms   ComputeLightGrid 5 draws 5 prims 0 verts
LogRHI:        0.3% 0.01ms   CullLights 30x17x32 NumLights 0 NumCaptures 1 4 draws 4 prims 0 verts
LogRHI:        0.2% 0.01ms   Compact 1 draws 1 prims 0 verts
LogRHI:     0.1% 0.00ms   BeginOcclusionTests 16 draws 192 prims 128 verts
LogRHI:        0.1% 0.00ms   ViewOcclusionTests 0 16 draws 192 prims 128 verts
LogRHI:           0.1% 0.00ms   IndividualQueries 16 draws 192 prims 128 verts
</code></pre>
<p>如果不需要gpu耗时存到文本，也不需要GUI面板，只是在屏幕上实时打印（但数据远不如<code>profilegpu</code>文本数据详细），使用命令：</p>
<pre><code>stat gpu
</code></pre>
<div class="alert warning ">
  <p>如果是在编辑器模式，建议以“独立游戏”(Standalone Game)PIE模式运行，否则会把编辑器的消耗也算进去（即使是全屏模式）。</p>
</div>
<p>GPU Profiling<br>
<a href="https://docs.unrealengine.com/en-us/Engine/Performance/GPU">https://docs.unrealengine.com/en-us/Engine/Performance/GPU</a></p>
<h5 id="memory">Memory</h5>
<p>查看low-level memory占用（启动游戏需追加参数：<code>MyGame.exe -LLM</code>）：</p>
<pre><code>stat LLMFull
</code></pre>
<p>查看Streaming内存占用详情（主要是texture内存占用）：</p>
<pre><code>stat Streaming
stat StreamingOverview
</code></pre>
<p>其中，texture pool大小等于<code>Safety Pool</code> + <code>Temporary Pool</code> + <code>Streaming Pool</code> + <code>NonStreaming Mips</code><br>
文档：<a href="https://docs.unrealengine.com/4.27/en-US/RenderingAndGraphics/Textures/Streaming/Stat/">Reporting Texture Streaming Metrics</a></p>
<p>内存相关的优化调试命令：<code>memreport</code>或者<code>memreport -full</code>。</p>
<pre><code>//这些命令定义在 Engine\Config\BaseEngine.ini 中
[MemReportCommands]
; These commands are run when memreport is executed, and output to a profile file
+Cmd=&quot;Mem FromReport&quot;
+Cmd=&quot;LogCountedInstances&quot;
+Cmd=&quot;obj list -alphasort&quot;
+Cmd=&quot;rhi.DumpMemory&quot;
+Cmd=&quot;LogOutStatLevels&quot;
+Cmd=&quot;ListSpawnedActors&quot;

[MemReportFullCommands]
; Additional commands to run with memreport -full
+Cmd=&quot;DumpParticleMem&quot;
+Cmd=&quot;ConfigMem&quot;
+Cmd=&quot;r.DumpRenderTargetPoolMemory&quot;
+Cmd=&quot;ListTextures&quot;
+Cmd=&quot;ListSounds -alphasort&quot;
+Cmd=&quot;ListParticleSystems -alphasort&quot;
+Cmd=&quot;obj list class=SoundWave -alphasort&quot;
+Cmd=&quot;obj list class=SkeletalMesh -alphasort&quot;
+Cmd=&quot;obj list class=StaticMesh -alphasort&quot;
+Cmd=&quot;obj list class=Level -alphasort&quot;
+Cmd=&quot;obj list class=StaticMeshComponent -alphasort&quot;
</code></pre>
<p>使用<code>obj list</code>时，<code>-alphasort</code>表示按名字排序，其他可选项有：<code>-countsort</code>按数量排序，<code>-resourcesizesort</code>按内存占用大小排序。<br>
<code>ListTextures</code>只支持名字排序，若要按内存占用排序，需要改引擎代码，代码位置：<code>UEngine::HandleListTexturesCommand()</code>（位于Engine\Source\Runtime\Engine\Private\UnrealEngine.cpp）。</p>
<p>处理<code>obj list</code>命令的代码位置：<br>
Engine\Source\Runtime\Engine\Private\UnrealEngine.cpp</p>
<pre><code>else if( FParse::Command(&amp;Cmd,TEXT(&quot;LIST&quot;)) )
</code></pre>
<p>Low-Level Memory Tracker. Going over how to use the Low-Level Memory Tracker in your Unreal Engine projects.<br>
<a href="https://docs.unrealengine.com/4.27/en-US/ProductionPipelines/DevelopmentSetup/Tools/LowLevelMemoryTracker/">https://docs.unrealengine.com/4.27/en-US/ProductionPipelines/DevelopmentSetup/Tools/LowLevelMemoryTracker/</a></p>
<p>Debugging and Optimizing Memory<br>
<a href="https://www.unrealengine.com/en-US/blog/debugging-and-optimizing-memory">https://www.unrealengine.com/en-US/blog/debugging-and-optimizing-memory</a></p>
<h5 id="crash-testing">Crash Testing</h5>
<p>Force game crash (not available in shipping):</p>
<pre><code>debug threadcrash
</code></pre>
<h3 id="misc">Misc</h3>
<h5 id="工程设置相关">工程设置相关</h5>
<div class="alert warning ">
  <p>使用stat相关命令检测性能时，需要关闭Smooth Frame Rate来保证检测结果更精准：<br>
Project Settings -&gt; Engine -&gt; General Settings -&gt; Framerate -&gt; Uncheck <code>Smooth Frame Rate</code>。</p>
</div>
<h5 id="运行时期间用c执行console命名">运行时期间用C++执行console命名</h5>
<pre><code>UKismetSystemLibrary::ExecuteConsoleCommand(UObject* WorldContextObject, 
    const FString&amp; Command, class APlayerController* SpecificPlayer = nullptr );
</code></pre>
<h5 id="scalability">Scalability</h5>
<p>Modify graphics quality at run-time:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Text" data-lang="Text"><span style="display:flex;"><span>r.PostProcessAAQuality 4
</span></span><span style="display:flex;"><span>sg.PostProcessQuality 3
</span></span><span style="display:flex;"><span>sg.ShadowQuality 3
</span></span><span style="display:flex;"><span>sg.TextureQuality 3
</span></span><span style="display:flex;"><span>sg.EffectsQuality 3
</span></span><span style="display:flex;"><span>foliage.DensityScale 1.0
</span></span><span style="display:flex;"><span>grass.DensityScale 1.0
</span></span></code></pre></div><p>For more detail see: <a href="https://dawnarc.com/2023/04/ue4scalability-notes/">Unreal Engine Scalability</a></p>
<h5 id="如何在引擎或游戏启动时执行命令">如何在引擎或游戏启动时执行命令</h5>
<p>方式1：修改 Engine/Config/ConsoleVariables.ini，例如，</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Text" data-lang="Text"><span style="display:flex;"><span>[Startup]
</span></span><span style="display:flex;"><span>r.FogDensity = 0.9
</span></span><span style="display:flex;"><span>post.ImageGrain = 0.5
</span></span></code></pre></div><p>方式2：修改Engine.ini(BaseEngine.ini或者DefaultEngine.ini)，在<code>[SystemSettings]或[SystemSettingsEditor]</code>分段下追加。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Text" data-lang="Text"><span style="display:flex;"><span>[SystemSettings]
</span></span><span style="display:flex;"><span>r.DetectAndWarnOfBadDrivers = 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[SystemSettingsEditor]
</span></span><span style="display:flex;"><span>; System settings overrides for the editor.  Ideally the editor should use the same settings as the game.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>; Do not vsync in the editor. Throws off gpu profiling.
</span></span><span style="display:flex;"><span>r.VSync=0
</span></span></code></pre></div><p><code>[ConsoleVariables]</code>分段也可添加，参考：UE5/Engine/Config/Android/AndroidEngine.ini</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Text" data-lang="Text"><span style="display:flex;"><span>[ConsoleVariables]
</span></span><span style="display:flex;"><span>Slate.CacheRenderData=0
</span></span><span style="display:flex;"><span>r.VSync=1
</span></span><span style="display:flex;"><span>r.ParallelShadows=0
</span></span><span style="display:flex;"><span>; high priority thread tasks can be downgraded to normal priority if a task is created with EPowerSavingEligibility::Eligible.
</span></span><span style="display:flex;"><span>TaskGraph.EnablePowerSavingThreadPriorityReduction=1
</span></span><span style="display:flex;"><span>; prefer D24_S8 for depth/stencil
</span></span><span style="display:flex;"><span>r.Vulkan.Depth24Bit=1
</span></span><span style="display:flex;"><span>;GalaxyS6Edge=577
</span></span><span style="display:flex;"><span>r.Shadow.ForceSerialSingleRenderPass=1
</span></span><span style="display:flex;"><span>; Support Mali 64k texel buffer limitation, tuned for 1080p. If you target 2k-4k resolutions please also set the LightGridPixelSize to 128
</span></span><span style="display:flex;"><span>r.Forward.LightGridSizeZ = 8
</span></span><span style="display:flex;"><span>r.Forward.MaxCulledLightsPerCell = 8
</span></span><span style="display:flex;"><span>r.HairStrands.Simulation=0
</span></span><span style="display:flex;"><span>r.HairStrands.Strands=0
</span></span><span style="display:flex;"><span>r.HairStrands.Binding=0
</span></span><span style="display:flex;"><span>; R11G11B10 UAV is not supported on Android
</span></span><span style="display:flex;"><span>r.TemporalAA.R11G11B10History=0
</span></span><span style="display:flex;"><span>; Do not backtrace vulkan memory allocations
</span></span><span style="display:flex;"><span>r.Vulkan.MemoryBacktrace=0
</span></span></code></pre></div><h5 id="查询命令的参数值">查询命令的参数值</h5>
<p>C++ 或者 蓝图中使用查询函数</p>
<pre><code>float UKismetSystemLibrary::GetConsoleVariableFloatValue(const FString&amp; VariableName)

int32 UKismetSystemLibrary::GetConsoleVariableIntValue(const FString&amp; VariableName)
</code></pre>
<p>例如：</p>
<p>先在命令行执行</p>
<pre><code>r.ScreenPercentage 200
</code></pre>
<p>然后通过蓝图或者C++查询</p>
<pre><code>//RetVal is 200.f
float RetVal = KismetSystemLibrary::GetConsoleVariableIntValue(TEXT(&quot;r.ScreenPercentage&quot;));
</code></pre>
<h3 id="文档">文档</h3>
<h5 id="commands">Commands</h5>
<p>Stat Commands<br>
<a href="https://docs-origin.unrealengine.com/latest/INT/Engine/Performance/StatCommands/">https://docs-origin.unrealengine.com/latest/INT/Engine/Performance/StatCommands/</a></p>
<p>Unreal Engine 4 Console Variables and Commands<br>
<a href="https://digilander.libero.it/ZioYuri78/">https://digilander.libero.it/ZioYuri78/</a></p>
<p>Measuring Performance<br>
<a href="https://unrealartoptimization.github.io/book/process/measuring-performance/">https://unrealartoptimization.github.io/book/process/measuring-performance/</a></p>
<p>Unreal Engine 4.19 Console Variables and Commands<br>
<a href="https://pongrit.github.io/">https://pongrit.github.io/</a></p>
<hr>
<p><code>及至始皇，奋六世之余烈，振长策而御宇内，吞二周而亡诸侯，履至尊而制六合，执敲扑而鞭笞天下，威振四海。 -《过秦论》·贾谊（西汉）</code></p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://dawnarc.com/tags/unrealengine4/">UnrealEngine4</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2016/05/hexoserver%E5%90%AF%E5%8A%A8%E5%BC%82%E5%B8%B8yamlexception/" data-tooltip="[hexo]server启动异常：YAMLException">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2016/05/nginx%E5%AE%89%E8%A3%85%E7%AE%80%E7%95%A5%E6%AD%A5%E9%AA%A4/" data-tooltip="Nginx安装简略步骤">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            <script src="https://utteranc.es/client.js"
  repo="dawnarc/dawnarc.github.io"
  issue-term="pathname"
  label="Comment"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2024 Wang Aiguo. All Rights Reserved. Powered by <A href="https://gohugo.io/"> Hugo</A> | Theme <A href="https://github.com/kakawait/hugo-tranquilpeak-theme/">Tranquilpeak</A>.
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2016/05/hexoserver%E5%90%AF%E5%8A%A8%E5%BC%82%E5%B8%B8yamlexception/" data-tooltip="[hexo]server启动异常：YAMLException">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2016/05/nginx%E5%AE%89%E8%A3%85%E7%AE%80%E7%95%A5%E6%AD%A5%E9%AA%A4/" data-tooltip="Nginx安装简略步骤">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Wang Aiguo</h4>
    
      <div id="about-card-bio">白金翰大堂经理</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Developer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Yichang, Hubei
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('https://dawnarc.com/images/cover-v1.2.0.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

	<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/school-book.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://dawnarc.com/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
  document.querySelectorAll('pre code').forEach((el) => {
    hljs.highlightElement(el);
  });
});
</script>






    
  </body>
</html>

