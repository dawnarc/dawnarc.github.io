<!DOCTYPE html>
<html lang="en">
  <head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4843403245883139"
     crossorigin="anonymous"></script>

<script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.145.0 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Wang Aiguo">
<meta name="keywords" content="UE4, GarbageCollect, TSharedPtr, TWeakObjectPtr">
<meta name="description" content="TSharedPtr, TWeakPtr and TUniquePtr imitated from shared_ptr, weak_ptr and unique_ptr of C&#43;&#43;11.">


<meta property="og:description" content="TSharedPtr, TWeakPtr and TUniquePtr imitated from shared_ptr, weak_ptr and unique_ptr of C&#43;&#43;11.">
<meta property="og:type" content="article">
<meta property="og:title" content="[UE4] TSharedPtr, TWeakObjectPtr and TUniquePtr">
<meta name="twitter:title" content="[UE4] TSharedPtr, TWeakObjectPtr and TUniquePtr">
<meta property="og:url" content="https://dawnarc.com/2018/07/ue4-tsharedptr-tweakobjectptr-and-tuniqueptr/">
<meta property="twitter:url" content="https://dawnarc.com/2018/07/ue4-tsharedptr-tweakobjectptr-and-tuniqueptr/">
<meta property="og:site_name" content="玄冬Wong">
<meta property="og:description" content="TSharedPtr, TWeakPtr and TUniquePtr imitated from shared_ptr, weak_ptr and unique_ptr of C&#43;&#43;11.">
<meta name="twitter:description" content="TSharedPtr, TWeakPtr and TUniquePtr imitated from shared_ptr, weak_ptr and unique_ptr of C&#43;&#43;11.">
<meta property="og:locale" content="en">

  
    <meta property="article:published_time" content="2018-07-04T16:44:02">
  
  
    <meta property="article:modified_time" content="2024-11-18T18:47:06">
  
  
  
    
      <meta property="article:section" content="UnrealEngine4">
    
  
  
    
      <meta property="article:tag" content="UE4">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://dawnarc.com/thumbnail/beijing/thumbnail-beijing-024.jpg">
  <meta property="twitter:image" content="https://dawnarc.com/thumbnail/beijing/thumbnail-beijing-024.jpg">






    <title>[UE4] TSharedPtr, TWeakObjectPtr and TUniquePtr</title>

    <link rel="icon" href="https://dawnarc.com/favicon.png">
    

    <link rel="canonical" href="https://dawnarc.com/2018/07/ue4-tsharedptr-tweakobjectptr-and-tuniqueptr/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://dawnarc.com/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    
      
        <link rel="stylesheet" href="https://dawnarc.com/cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/paraiso-light.min.css">
      
    

    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4P9RSN4PXQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4P9RSN4PXQ');
</script>
  
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://dawnarc.com/">玄冬Wong</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://dawnarc.com/#about">
    
    
    
      
    
    </a>
    
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    <div class="sidebar-profile">
        <a href="https://dawnarc.com/#about">
          <img class="sidebar-profile-picture" src="https://dawnarc.com/avatar.jpg" alt="" />
        </a>
        <h4 class="sidebar-profile-name">Wang Aiguo</h4>
        <h5 class="sidebar-profile-bio">山河固，九边殊，万里川原，龙旗指处。</h5>
      </div>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/1645289/protoss" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.facebook.com/koanland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-facebook"></i>
      
      <span class="sidebar-button-desc">Facebook</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.instagram.com/dawn_arc/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-instagram"></i>
      
      <span class="sidebar-button-desc">Instagram</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/dawnarc/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
      
      <span class="sidebar-button-desc">Linkedin</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.pinterest.com/wangaiguo/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-pinterest"></i>
      
      <span class="sidebar-button-desc">Pinterest</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://steamcommunity.com/id/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-steam"></i>
      
      <span class="sidebar-button-desc">Steam</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/dawn_arc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://weibo.com/koanland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-weibo"></i>
      
      <span class="sidebar-button-desc">Weibo</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      [UE4] TSharedPtr, TWeakObjectPtr and TUniquePtr
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-07-04T16:44:02&#43;08:00">
        
  
  
  
  
    Wednesday, 16:44, Jul 4, 2018
  

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://dawnarc.com/categories/unrealengine4">UnrealEngine4</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
			<amp-auto-ads type="adsense"
					data-ad-client="ca-pub-4843403245883139">
			</amp-auto-ads>
            <div class="main-content-wrap">
                <ins class="adsbygoogle"
                     style="display:block;height:120px"
                     data-ad-client="ca-pub-4843403245883139"
                     data-ad-slot="2321022024"
                     data-ad-format="fluid"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
              <p><code>TSharedPtr</code>, <code>TWeakPtr</code> and <code>TUniquePtr</code> imitated from <code>shared_ptr</code>, <code>weak_ptr</code> and <code>unique_ptr</code> of C++11.</p>
<h3 id="tsharedptr">TSharedPtr</h3>
<h5 id="summary">Summary</h5>
<p><code>TSharedPtr</code> is the counter of reference of raw objects (Non-UObject). The count that <code>TSharedPtr</code> reference to would increase one while <code>TSharedPtr</code> was assigned once, the object would be destroyed when the count of reference is 0.</p>
<p>Usage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TSharedPtr<span style="color:#f92672">&lt;</span>FRawClass<span style="color:#f92672">&gt;</span> ObjPtr <span style="color:#f92672">=</span> MakeShareable(<span style="color:#66d9ef">new</span> FRawClass());
</span></span></code></pre></div><h5 id="example">Example</h5>
<p>RawClass.h</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#pragma once
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;CoreMinimal.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TP_54_API</span> FRawClass
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    FRawClass()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        GEngine<span style="color:#f92672">-&gt;</span>AddOnScreenDebugMessage(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5.f</span>, FColor<span style="color:#f92672">::</span>Cyan, TEXT(<span style="color:#e6db74">&#34;=== Construct&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">~</span>FRawClass()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        GEngine<span style="color:#f92672">-&gt;</span>AddOnScreenDebugMessage(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5.f</span>, FColor<span style="color:#f92672">::</span>Orange, TEXT(<span style="color:#e6db74">&#34;=== Destruct&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>MyTestGameMode.h</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#pragma once
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;CoreMinimal.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;GameFramework/GameModeBase.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;MyTestGameMode.generated.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FRawClass</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>UCLASS(minimalapi)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AMyTestGameMode</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> AGameModeBase
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    GENERATED_BODY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    AMyTestGameMode();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UFUNCTION(Exec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> CreatePtr();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UFUNCTION(Exec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> ReleaseFoo();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UFUNCTION(Exec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> ReleaseBar();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    TSharedPtr<span style="color:#f92672">&lt;</span>FRawClass<span style="color:#f92672">&gt;</span> Foo <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>    TSharedPtr<span style="color:#f92672">&lt;</span>FRawClass<span style="color:#f92672">&gt;</span> Bar <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>MyTestGameMode.cpp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;RawClass.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Templates/SharedPointer.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyTestGameMode<span style="color:#f92672">::</span>CreatePtr()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Foo <span style="color:#f92672">=</span> MakeShareable(<span style="color:#66d9ef">new</span> FRawClass());
</span></span><span style="display:flex;"><span>    Bar <span style="color:#f92672">=</span> Foo;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyTestGameMode<span style="color:#f92672">::</span>ReleaseFoo()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Foo <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyTestGameMode<span style="color:#f92672">::</span>ReleaseBar()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Bar <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Console command for testing:</p>
<pre tabindex="0"><code class="language-Log" data-lang="Log">CreatePtr       //screen prints: === Construct
ReleaseFoo      //nothing happens
ReleaseBar      //screen prints: === Destruct
</code></pre><h5 id="cautions">Cautions</h5>
<div class="alert danger ">
  <p>Objects would never be destroyed if two <code>TSharedPtr</code>, which are reference to a same object, were assigned to each other, resulting a memory leak.</p>
</div>
<div class="alert warning ">
  <p>If the class of TSharedPtr contains lambda functions, you must be careful to ensure the current object is valid while executing lambda, because the object ref counter may reach to zero which causes the destruction in the gap time between current function and lambda function.<br>
For more details, see: <a href="https://dawnarc.com/2017/12/ue4gameplay-dev-notes/#shared-pointer-in-async-task">Shared Pointer in Async Task</a></p>
</div>
<h5 id="whether-if-tsharedptr-works-for-uobject-or-not">Whether if TSharedPtr works for UObject or not</h5>
<p>As the comments of <code>TSharedPtr</code> say, it only works for <code>raw pointers</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">/** Proxy structure for implicitly converting raw pointers to shared/weak pointers */</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// NOTE: The following is an Unreal extension to standard shared_ptr behavior
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ObjectType</span> <span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">FRawPtrProxy</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/** The object pointer */</span>
</span></span><span style="display:flex;"><span>    ObjectType<span style="color:#f92672">*</span> Object;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/** Reference controller used to destroy the object */</span>
</span></span><span style="display:flex;"><span>    FReferenceControllerBase<span style="color:#f92672">*</span> ReferenceController;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/** Construct implicitly from an object */</span>
</span></span><span style="display:flex;"><span>    FORCEINLINE <span style="color:#a6e22e">FRawPtrProxy</span>( ObjectType<span style="color:#f92672">*</span> InObject )
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> Object             ( InObject )
</span></span><span style="display:flex;"><span>        , ReferenceController( NewDefaultReferenceController( InObject ) )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/** Construct implicitly from an object and a custom deleter */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Deleter</span> <span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    FORCEINLINE FRawPtrProxy( ObjectType<span style="color:#f92672">*</span> InObject, Deleter<span style="color:#f92672">&amp;&amp;</span> InDeleter )
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> Object             ( InObject )
</span></span><span style="display:flex;"><span>        , ReferenceController( NewCustomReferenceController( InObject, Forward<span style="color:#f92672">&lt;</span> Deleter <span style="color:#f92672">&gt;</span>( InDeleter ) ) )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>In theory, Unreal GC system is to <code>UObject</code> what <code>std::shared_ptr&lt;&gt;</code> is to raw pointer, so <code>TSharedPtr</code> doesn&rsquo;t need to work for <code>UObject</code>.<br>
But, there&rsquo;s no limitation for counting <code>UObject</code> in the source code of <code>SharedPointerInternals.h</code> in engine.<br>
If an <code>UObject</code> was passed as constructor&rsquo;s argument of <code>TSharedPtr</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> ATestPlayerController<span style="color:#f92672">::</span>TestFun()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    TestActor <span style="color:#f92672">=</span> NewObject<span style="color:#f92672">&lt;</span>AActor<span style="color:#f92672">&gt;</span>(<span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>    TSharedPtr<span style="color:#f92672">&lt;</span>AActor<span style="color:#f92672">&gt;</span> SharePtr2 <span style="color:#f92672">=</span> MakeShareable(TestActor);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>application will crash after jumping out of function <code>TestFun</code>:</p>
<pre tabindex="0"><code class="language-Log" data-lang="Log">Assertion failed: GetFName() == NAME_None [File:D:/Build/++UE4/Sync/Engine/Source/Runtime/CoreUObject/Private/UObject/UObjectBase.cpp] [Line: 136]

UE4Editor_Core!AssertFailedImplV() [d:\build\++ue4\sync\engine\source\runtime\core\private\misc\assertionmacros.cpp:105]
UE4Editor_Core!FDebug::CheckVerifyFailedImpl() [d:\build\++ue4\sync\engine\source\runtime\core\private\misc\assertionmacros.cpp:455]
UE4Editor_CoreUObject!UObjectBase::~UObjectBase() [d:\build\++ue4\sync\engine\source\runtime\coreuobject\private\uobject\uobjectbase.cpp:136]
UE4Editor_Engine!AActor::`vector deleting destructor&#39;()
UE4Editor_TestTD4_Win64_DebugGame!SharedPointerInternals::TReferenceControllerWithDeleter&lt;AActor,SharedPointerInternals::DefaultDeleter&lt;AActor&gt; &gt;::DestroyObject() [D:\Program_Files\Epic Games\UE_4.24\Engine\Source\Runtime\Core\Public\Templates\SharedPointerInternals.h:116]
UE4Editor_TestTD4_Win64_DebugGame!TSharedPtr&lt;AActor,0&gt;::~TSharedPtr&lt;AActor,0&gt;()
UE4Editor_TestTD4_Win64_DebugGame!ATestPlayerController::TestFun() [D:\workspace\unreal_dev\TestTD4\Source\TestTD4\TestTD4PlayerController.cpp:124]
</code></pre><div class="alert danger ">
  <p>As shown above: If <code>TSharedPtr</code> reference to <code>UObject</code>, it works at compiling, initialization of <code>TSharedPtr</code> also works at run-time, but it crashed on destruction.</p>
</div>
<h5 id="how-to-add-raw-pointers-into-gc-of-unreal">How to add raw pointers into GC of Unreal</h5>
<div class="alert info ">
  <p>If want to add raw pointers into GC system of UE4, raw class must inherits from <code>FGCObject</code>.</p>
</div>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FAppleARKitVideoOverlay</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> FGCObject
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    FAppleARKitVideoOverlay();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>FAppleARKitVideoOverlay();
</span></span></code></pre></div><h3 id="tweakptr">TWeakPtr</h3>
<h5 id="example-1">Example</h5>
<p>RawClass.h</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#pragma once
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;CoreMinimal.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MYTEST_API</span> FRawClass
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    FRawClass()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        GEngine<span style="color:#f92672">-&gt;</span>AddOnScreenDebugMessage(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5.f</span>, FColor<span style="color:#f92672">::</span>Cyan, TEXT(<span style="color:#e6db74">&#34;=== Construct&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">~</span>FRawClass()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        GEngine<span style="color:#f92672">-&gt;</span>AddOnScreenDebugMessage(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5.f</span>, FColor<span style="color:#f92672">::</span>Orange, TEXT(<span style="color:#e6db74">&#34;=== Destruct&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>MyTestGameMode.h</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#pragma once
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;CoreMinimal.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;GameFramework/GameModeBase.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;MyTestGameMode.generated.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FRawClass</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>UCLASS(minimalapi)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AMyTestGameMode</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> AGameModeBase
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    GENERATED_BODY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    AMyTestGameMode();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UFUNCTION(Exec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> CreatePtr();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UFUNCTION(Exec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> ReleaseFoo();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UFUNCTION(Exec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> ReleaseBar();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UFUNCTION(Exec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> KeepBaz();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UFUNCTION(Exec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> ReleaseQux();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UFUNCTION(Exec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> CheckBaz();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    TSharedPtr<span style="color:#f92672">&lt;</span>FRawClass<span style="color:#f92672">&gt;</span> Foo <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>    TSharedPtr<span style="color:#f92672">&lt;</span>FRawClass<span style="color:#f92672">&gt;</span> Bar <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    TWeakPtr<span style="color:#f92672">&lt;</span>FRawClass<span style="color:#f92672">&gt;</span> Baz <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>    TSharedPtr<span style="color:#f92672">&lt;</span>FRawClass<span style="color:#f92672">&gt;</span> Qux <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>MyTestGameMode.cpp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;RawClass.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Templates/SharedPointer.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyTestGameMode<span style="color:#f92672">::</span>CreatePtr()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Foo <span style="color:#f92672">=</span> MakeShareable(<span style="color:#66d9ef">new</span> FRawClass());
</span></span><span style="display:flex;"><span>    Bar <span style="color:#f92672">=</span> Foo;
</span></span><span style="display:flex;"><span>    Baz <span style="color:#f92672">=</span> Foo;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Baz = new FRawClass();    //compilation error: weak ptr must be initialized with share ptr.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyTestGameMode<span style="color:#f92672">::</span>ReleaseFoo()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Foo <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyTestGameMode<span style="color:#f92672">::</span>ReleaseBar()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Bar <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyTestGameMode<span style="color:#f92672">::</span>KeepBaz()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//create a new TSharedPtr from TWeakPtr to keep the object ref.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Qux <span style="color:#f92672">=</span> Baz.Pin();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyTestGameMode<span style="color:#f92672">::</span>ReleaseQux()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Qux <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyTestGameMode<span style="color:#f92672">::</span>CheckBaz()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    FString Info <span style="color:#f92672">=</span> Baz.IsValid() <span style="color:#f92672">?</span> TEXT(<span style="color:#e6db74">&#34;Valid+++&#34;</span>) <span style="color:#f92672">:</span> TEXT(<span style="color:#e6db74">&#34;Invalid---&#34;</span>);
</span></span><span style="display:flex;"><span>    GEngine<span style="color:#f92672">-&gt;</span>AddOnScreenDebugMessage(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5.f</span>, FColor<span style="color:#f92672">::</span>Cyan, Info);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Console command for testing weak ptr:</p>
<pre tabindex="0"><code class="language-Log" data-lang="Log">CreatePtr       //screen prints: === Construct
ReleaseFoo      //nothing happens
CheckBaz        //screen prints: Valid+++
ReleaseBar      //screen prints: === Destruct
CheckBaz        //screen prints: Invalid---
</code></pre><p>Console command for testing Pin function:</p>
<pre tabindex="0"><code class="language-Log" data-lang="Log">CreatePtr       //screen prints: === Construct
ReleaseFoo      //nothing happens
CheckBaz        //screen prints: Valid+++
KeepBaz         //creat a new shared ptr to keep object ref
ReleaseBar      //nothing happens
ReleaseQux      //screen prints: === Destruct
CheckBaz        //screen prints: Invalid---
</code></pre><h3 id="tuniqueptr-unique-pointers">TUniquePtr (Unique Pointers)</h3>
<h5 id="summary-1">Summary</h5>
<p>A Unique Pointer solely and explicitly owns the object it references. Since there can only be one Unique Pointer to a given resource, Unique Pointers can transfer ownership, but cannot share it. Any attempts to copy a Unique Pointer will result in a compile error. When a Unique Pointer is goes out of scope, it will automatically delete the object it references.</p>
<div class="alert danger ">
  <p><code>TUniquePtr</code> works for Non-UObject, there&rsquo;s compilation error while initializing <code>TUniquePtr</code> with <code>UObject</code>.</p>
</div>
<h5 id="example--basic">Example : Basic</h5>
<p>Define:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TUniquePtr<span style="color:#f92672">&lt;</span>FMeshTriOctree<span style="color:#f92672">&gt;</span> MTOctree;
</span></span></code></pre></div><p>Instantiate:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>MTOctree <span style="color:#f92672">=</span> MakeUnique<span style="color:#f92672">&lt;</span>FMeshTriOctree<span style="color:#f92672">&gt;</span>(Bounds.GetCenter(), Bounds.GetExtent().GetMax());
</span></span></code></pre></div><p>Pass reference between two TUniquePtr:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TUniquePtr<span style="color:#f92672">&lt;</span>FMeshTriOctree<span style="color:#f92672">&gt;</span> MTOctree02 <span style="color:#f92672">=</span> MoveTemp(MTOctree);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//TUniquePtr&lt;FMeshTriOctree&gt; MTOctree02 = MTOctree; // compilation error
</span></span></span></code></pre></div><p>If you assign to new TUniquePtr without <code>MoveTemp</code>, you will get error:</p>
<pre tabindex="0"><code class="language-Log" data-lang="Log">error C2280: &#39;TUniquePtr&lt;FMeshTriOctree,TDefaultDelete&lt;T&gt;&gt;::TUniquePtr(const TUniquePtr&lt;T,TDefaultDelete&lt;T&gt;&gt; &amp;)&#39;: attempting to reference a deleted function
</code></pre><h5 id="example--tuniqueptr--tqueue">Example : TUniquePtr &amp; TQueue</h5>
<p>Add element:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FTestStruct</span> 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TQueue<span style="color:#f92672">&lt;</span>TUniquePtr<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;&gt;</span> TestQueue;
</span></span><span style="display:flex;"><span>TUniquePtr<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;</span> Ptr <span style="color:#f92672">=</span> MakeUnique<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;</span>();
</span></span><span style="display:flex;"><span>TestQueue.Enqueue(MoveTemp(Ptr));
</span></span></code></pre></div><p>If forget to invoke <code>MoveTemp</code>, e.g.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TQueue<span style="color:#f92672">&lt;</span>TUniquePtr<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;&gt;</span> TestQueue;
</span></span><span style="display:flex;"><span>TUniquePtr<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;</span> Ptr <span style="color:#f92672">=</span> MakeUnique<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;</span>();
</span></span><span style="display:flex;"><span>TestQueue.Enqueue(Ptr);
</span></span></code></pre></div><p>You will get error:</p>
<pre tabindex="0"><code class="language-Log" data-lang="Log">D:\UE_4.22\Engine\Source\Runtime\Core\Public\Containers/Queue.h(252): error C2248: &#39;TUniquePtr&lt;FTestStruct,TDefaultDelete&lt;T&gt;&gt;::TUniquePtr&#39;: cannot access private member declared in class &#39;TUniquePtr&lt;FTestStruct,TDefaultDelete&lt;T&gt;&gt;&#39;
</code></pre><p>Remove element:<br>
1st way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TUniquePtr<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;</span> Ptr <span style="color:#f92672">=</span> MoveTemp(TestQueue.Peek());
</span></span><span style="display:flex;"><span>TestQueue.pop();
</span></span></code></pre></div><p>2nd way (recommended) :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TUniquePtr<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;</span> Buffer;
</span></span><span style="display:flex;"><span>TestQueue.Dequeue(Buffer)
</span></span></code></pre></div><h5 id="example--tuniqueptr--tarray">Example : TUniquePtr &amp; TArray</h5>
<p>Define:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TArray<span style="color:#f92672">&lt;</span>TWeakObjectPtr<span style="color:#f92672">&lt;</span>APawn<span style="color:#f92672">&gt;&gt;</span> TestArray;
</span></span></code></pre></div><p>Add Element:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TUniquePtr<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;</span> Ptr <span style="color:#f92672">=</span> MakeUnique<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;</span>();
</span></span><span style="display:flex;"><span>TestArray.Add(MoveTemp(Ptr));
</span></span></code></pre></div><p>Remove element:<br>
1st way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TUniquePtr<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;</span> Ptr <span style="color:#f92672">=</span> MoveTemp(TestArray[TestArray.Num() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>TestArray.RemoveAt(TestArray.Num() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span></code></pre></div><p>2nd way (recommended) :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TUniquePtr<span style="color:#f92672">&lt;</span>FTestStruct<span style="color:#f92672">&gt;</span> Ptr <span style="color:#f92672">=</span> TestArray.Pop();
</span></span></code></pre></div><h3 id="tweakobjectptr">TWeakObjectPtr</h3>
<h5 id="summary-2">Summary</h5>
<p>The memory (UObjects only, not raw objects) presented by <code>TWeakObjectPtr</code> can&rsquo;t be prevented from garbage collecting. Once the object that was presented by <code>TWeakObjectPtr</code> was destroyed in other place, the inner pointer of <code>TWeakObjectPtr</code> would be assigned as <code>nullptr</code> automatically, and <code>TWeakObjectPtr::IsValid()</code> would return <code>false</code>. But <code>TSharedPtr</code> has no features of <code>TWeakObjectPtr</code>.</p>
<h5 id="tweakobjectptr-vs-tweakptr">TWeakObjectPtr vs TWeakPtr</h5>
<p>Difference:</p>
<ul>
<li>TWeakObjectPtr works for UObjects only, TWeakPtr works for raw objects (Non-UObject) only;</li>
<li>TWeakObjectPtr can works independently with UObjects, while TWeakPtr must work with TSharedPtr.</li>
</ul>
<h5 id="usage">Usage</h5>
<p>Assignment</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TWeakObjectPtr<span style="color:#f92672">&lt;</span>AActor<span style="color:#f92672">&gt;</span> MyWeakActor;
</span></span><span style="display:flex;"><span>MyWeakActor <span style="color:#f92672">=</span> MyActor;
</span></span></code></pre></div><p>Get value</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>AActor<span style="color:#f92672">*</span> Actor <span style="color:#f92672">=</span> MyWeakActor.Get();
</span></span></code></pre></div><p>or</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(MyWeakActor.Get())
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    ACharacter<span style="color:#f92672">*</span> Character <span style="color:#f92672">=</span> Cast<span style="color:#f92672">&lt;</span>ACharacter<span style="color:#f92672">&gt;</span>(MyWeakActor);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>if <code>MyActor</code> has been destroyed, <code>MyWeakActor.Get()</code> returns <code>nullptr</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>MyActor<span style="color:#f92672">-&gt;</span>Destroy();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> IsNull <span style="color:#f92672">=</span> MyWeakActor.Get() <span style="color:#f92672">==</span> <span style="color:#66d9ef">nullptr</span>;    <span style="color:#75715e">//true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">bool</span> IsValid <span style="color:#f92672">=</span> MyWeakActor.IsValid();    <span style="color:#75715e">//false
</span></span></span></code></pre></div><div class="alert danger ">
  <p>if <code>MyActor</code> has been recycled by GC, <code>Cast&lt;AMyCharacter&gt;(MyActor)</code> would cause crash after a while, but <code>Cast&lt;AMyCharacter&gt;(MyWeakActor)</code> would not.</p>
</div>
<h5 id="remove-in-array">Remove in Array</h5>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>TArray<span style="color:#f92672">&lt;</span>TWeakObjectPtr<span style="color:#f92672">&lt;</span>APawn<span style="color:#f92672">&gt;&gt;</span> TestArray;
</span></span><span style="display:flex;"><span>APawn<span style="color:#f92672">*</span> TestPawn01 <span style="color:#f92672">=</span> GetWorld()<span style="color:#f92672">-&gt;</span>SpawnActor<span style="color:#f92672">&lt;</span>APawn<span style="color:#f92672">&gt;</span>(APawn<span style="color:#f92672">::</span>StaticClass(), FVector(<span style="color:#ae81ff">100.f</span>, <span style="color:#ae81ff">100.f</span>, <span style="color:#ae81ff">0.f</span>), FRotator<span style="color:#f92672">::</span>ZeroRotator);
</span></span><span style="display:flex;"><span>APawn<span style="color:#f92672">*</span> TestPawn02 <span style="color:#f92672">=</span> GetWorld()<span style="color:#f92672">-&gt;</span>SpawnActor<span style="color:#f92672">&lt;</span>APawn<span style="color:#f92672">&gt;</span>(APawn<span style="color:#f92672">::</span>StaticClass(), FVector(<span style="color:#ae81ff">200.f</span>, <span style="color:#ae81ff">200.f</span>, <span style="color:#ae81ff">0.f</span>), FRotator<span style="color:#f92672">::</span>ZeroRotator);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TestArray.Add(TWeakObjectPtr<span style="color:#f92672">&lt;</span>APawn<span style="color:#f92672">&gt;</span>(TestPawn01));
</span></span><span style="display:flex;"><span>TestArray.Add(TWeakObjectPtr<span style="color:#f92672">&lt;</span>APawn<span style="color:#f92672">&gt;</span>(TestPawn02));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> Num <span style="color:#f92672">=</span> TestArray.Num();    <span style="color:#75715e">// 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>TWeakObjectPtr<span style="color:#f92672">&lt;</span>APawn<span style="color:#f92672">&gt;</span> WeakPtr1(TestPawn01);
</span></span><span style="display:flex;"><span>TestArray.Remove(WeakPtr1);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> Num2 <span style="color:#f92672">=</span> TestArray.Num();    <span style="color:#75715e">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>TWeakObjectPtr<span style="color:#f92672">&lt;</span>APawn<span style="color:#f92672">&gt;</span> WeakPtr2(TestPawn01);
</span></span><span style="display:flex;"><span>TestArray.Remove(WeakPtr2);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> Num3 <span style="color:#f92672">=</span> TestArray.Num();    <span style="color:#75715e">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>TestArray.Remove(TestPawn02);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> Num4 <span style="color:#f92672">=</span> TestArray.Num();    <span style="color:#75715e">// 0
</span></span></span></code></pre></div><h3 id="reference">Reference</h3>
<p>unreal-unique-pointer<br>
<a href="https://baemincheon.github.io/2020/03/14/unreal-unique-pointer/">https://baemincheon.github.io/2020/03/14/unreal-unique-pointer/</a></p>
<p>UE4 TSharedPtr和UObject的垃圾回收<br>
<a href="http://www.v5xy.com/?p=808">http://www.v5xy.com/?p=808</a></p>
<p>There&rsquo;s a Huge Difference, One Will Always Crash<br>
<a href="https://answers.unrealengine.com/questions/48818/whats-the-difference-between-using-tweakobjectptr.html">https://answers.unrealengine.com/questions/48818/whats-the-difference-between-using-tweakobjectptr.html</a></p>
<p>what is a &ldquo;weak object pointer&rdquo;?<br>
<a href="https://answers.unrealengine.com/questions/201186/what-is-a-weak-object-pointer.html">https://answers.unrealengine.com/questions/201186/what-is-a-weak-object-pointer.html</a></p>
<p>Unreal Smart Pointer Library<br>
<a href="https://docs.unrealengine.com/en-US/Programming/UnrealArchitecture/SmartPointerLibrary/index.html">https://docs.unrealengine.com/en-US/Programming/UnrealArchitecture/SmartPointerLibrary/index.html</a></p>
<p>TSharedPtr、UniquePtr、TWeakPtr、TSharedRef<br>
<a href="https://www.cnblogs.com/shiroe/p/14729821.html">https://www.cnblogs.com/shiroe/p/14729821.html</a></p>
<hr>
<p><code>已识乾坤大，犹怜草木青。长空送鸟印，留幻与人灵。 -马一浮《旷怡亭口占》</code></p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small"></span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://dawnarc.com/tags/ue4/">UE4</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2018/07/c-shared_ptr-%E4%B8%8E-weak_ptr-%E5%8C%BA%E5%88%AB/" data-tooltip="[C&#43;&#43;]shared_ptr 与 weak_ptr 区别">
              
                  <i class="fa fa-angle-left"></i>
                  NEXT
                  <span class="hide-xs hide-sm text-small icon-ml"></span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2018/07/ue4error-c3668-utexturecubeupdateresourcew/" data-tooltip="[UE4]error C3668: &#39;UTextureCube::UpdateResourceW&#39;">
              
                  <span class="hide-xs hide-sm text-small icon-mr"></span>
                  PREVIOUS
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            <script src="https://utteranc.es/client.js"
  repo="dawnarc/dawnarc.github.io"
  issue-term="pathname"
  label="Comment"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2025 Wang Aiguo. Powered by <A href="https://gohugo.io/"> Hugo</A> | Theme <A href="https://github.com/kakawait/hugo-tranquilpeak-theme/">Tranquilpeak</A>.
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2018/07/c-shared_ptr-%E4%B8%8E-weak_ptr-%E5%8C%BA%E5%88%AB/" data-tooltip="[C&#43;&#43;]shared_ptr 与 weak_ptr 区别">
              
                  <i class="fa fa-angle-left"></i>
                  NEXT
                  <span class="hide-xs hide-sm text-small icon-ml"></span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2018/07/ue4error-c3668-utexturecubeupdateresourcew/" data-tooltip="[UE4]error C3668: &#39;UTextureCube::UpdateResourceW&#39;">
              
                  <span class="hide-xs hide-sm text-small icon-mr"></span>
                  PREVIOUS
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
    
      <img id="about-card-picture" src=https://dawnarc.com/avatar.jpg alt="" />
    
    
    <h4 id="about-card-name">Wang Aiguo</h4>
    
      <div id="about-card-bio">山河固，九边殊，万里川原，龙旗指处。</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Developer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Yichang, Hubei
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('https://dawnarc.com/images/cover-v1.2.0.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

	<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/school-book.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://dawnarc.com/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
  document.querySelectorAll('pre code').forEach((el) => {
    hljs.highlightElement(el);
  });
});
</script>






    
  </body>
</html>

