<!DOCTYPE html>
<html lang="en-us">
  <head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4843403245883139"
     crossorigin="anonymous"></script>

<script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.102.3 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Wang Aiguo">
<meta name="keywords" content="OpenGL, Graphics, Foundations">
<meta name="description" content="keywords: OpenGL, cookbook, basic knowledge, foundations, Personal Sutdy Notes">


<meta property="og:description" content="keywords: OpenGL, cookbook, basic knowledge, foundations, Personal Sutdy Notes">
<meta property="og:type" content="article">
<meta property="og:title" content="[OpenGL]Foundations(Personal Sutdy Notes)">
<meta name="twitter:title" content="[OpenGL]Foundations(Personal Sutdy Notes)">
<meta property="og:url" content="https://dawnarc.com/2017/01/openglfoundationspersonal-sutdy-notes/">
<meta property="twitter:url" content="https://dawnarc.com/2017/01/openglfoundationspersonal-sutdy-notes/">
<meta property="og:site_name" content="玄冬Wong">
<meta property="og:description" content="keywords: OpenGL, cookbook, basic knowledge, foundations, Personal Sutdy Notes">
<meta name="twitter:description" content="keywords: OpenGL, cookbook, basic knowledge, foundations, Personal Sutdy Notes">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2017-01-13T14:28:40">
  
  
    <meta property="article:modified_time" content="2017-01-13T14:28:40">
  
  
  
    
      <meta property="article:section" content="OpenGL">
    
  
  
    
      <meta property="article:tag" content="Graphics">
    
      <meta property="article:tag" content="OpenGL">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@dawn_arc">


  <meta name="twitter:creator" content="@dawn_arc">






  <meta property="og:image" content="https://dawnarc.com/thumbnail/beijing/thumbnail-beijing-018.jpg">
  <meta property="twitter:image" content="https://dawnarc.com/thumbnail/beijing/thumbnail-beijing-018.jpg">





  <meta property="og:image" content="https://www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=640">


    <title>[OpenGL]Foundations(Personal Sutdy Notes)</title>

    <link rel="icon" href="https://dawnarc.com/favicon.png">
    

    

    <link rel="canonical" href="https://dawnarc.com/2017/01/openglfoundationspersonal-sutdy-notes/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://dawnarc.com/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    
      
        <link rel="stylesheet" href="https://dawnarc.com/cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/paraiso-light.min.css">
      
    

    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4P9RSN4PXQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4P9RSN4PXQ');
</script>
  
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://dawnarc.com/">玄冬Wong</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://dawnarc.com/#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=90" alt="Author&#39;s picture" />
      
    
    </a>
    
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://dawnarc.com/#about">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Wang Aiguo</h4>
        
          <h5 class="sidebar-profile-bio">白金翰大堂经理</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/1645289/protoss" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.facebook.com/koanland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-facebook"></i>
      
      <span class="sidebar-button-desc">Facebook</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.instagram.com/dawn_arc/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-instagram"></i>
      
      <span class="sidebar-button-desc">Instagram</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/dawnarc/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
      
      <span class="sidebar-button-desc">Linkedin</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.pinterest.com/wangaiguo/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-pinterest"></i>
      
      <span class="sidebar-button-desc">Pinterest</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://steamcommunity.com/id/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-steam"></i>
      
      <span class="sidebar-button-desc">Steam</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/dawn_arc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://weibo.com/koanland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-weibo"></i>
      
      <span class="sidebar-button-desc">Weibo</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      [OpenGL]Foundations(Personal Sutdy Notes)
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2017-01-13T14:28:40&#43;08:00">
        
  
  
  
  
    Friday, 14:28, Jan 13, 2017
  

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://dawnarc.com/categories/opengl">OpenGL</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
			<amp-auto-ads type="adsense"
					data-ad-client="ca-pub-4843403245883139">
			</amp-auto-ads>
            <div class="main-content-wrap">
                <ins class="adsbygoogle"
                     style="display:block;height:120px"
                     data-ad-client="ca-pub-4843403245883139"
                     data-ad-slot="2321022024"
                     data-ad-format="fluid"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
              <p>keywords: OpenGL, cookbook, basic knowledge, foundations, Personal Sutdy Notes</p>
<h5 id="参考资料">参考资料</h5>
<p>OpenGL Reference Documentation<br>
<a href="https://docs.gl/">https://docs.gl/</a></p>
<p>OpenGL 4 Shading Language Cookbook, Second Edition<br>
<a href="https://github.com/daw42/glslcookbook">https://github.com/daw42/glslcookbook</a></p>
<p>Learn OpenGL<br>
<a href="https://learnopengl.com/">https://learnopengl.com/</a></p>
<p>opengl-tutorial<br>
<a href="https://www.opengl-tutorial.org/">https://www.opengl-tutorial.org/</a></p>
<h5 id="术语解释">术语解释：</h5>
<ul>
<li><code>GLEW</code> (OpenGL Extension Wrangler).</li>
<li><code>GLM</code> (OpenGL Mathematics)</li>
<li><code>GLFW</code> is an Open Source, multi-platform library for OpenGL, OpenGL ES and Vulkan development on the desktop. It provides a simple API for creating windows, contexts and surfaces, receiving input and events.</li>
</ul>
<h5 id="shader类型">Shader类型</h5>
<ul>
<li>vertex shader</li>
<li>fragment shader（HLSL中叫做pixel shader，也是工业界的主流叫法）</li>
<li>geometry shader</li>
<li>tess_control shader</li>
<li>tess_evaluation shader</li>
<li>compute shader</li>
</ul>
<h5 id="opengl版本查询与设置">OpenGL版本查询与设置</h5>
<p>查询版本（使用glad的API）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>GLint major, minor;
</span></span><span style="display:flex;"><span>glGetIntegerv(GL_MAJOR_VERSION, <span style="color:#f92672">&amp;</span>major);
</span></span><span style="display:flex;"><span>glGetIntegerv(GL_MINOR_VERSION, <span style="color:#f92672">&amp;</span>minor);
</span></span></code></pre></div><p>选择版本（使用glfw的API）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">//OpenGL版本设置为4.6
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, <span style="color:#ae81ff">6</span>);
</span></span></code></pre></div><p>注意：设置版本号不得高于查询出来的版本号。</p>
<h5 id="批量填充populate数据">批量填充(populate)数据</h5>
<p>OpenGL 4.0之前，比如要填充vertex数据，必须要逐个vertex设置。4.0之后，可以一次性填充一组vertex。<br>
以填充position和color的vertex shader为例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">/////////////////// Create the VBO ////////////////////
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">float</span> positionData[] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#ae81ff">0.8f</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.8f</span>, <span style="color:#ae81ff">0.0f</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.8f</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.8f</span>, <span style="color:#ae81ff">0.0f</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.0f</span>,  <span style="color:#ae81ff">0.8f</span>, <span style="color:#ae81ff">0.0f</span> };
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">float</span> colorData[] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">1.0f</span>, <span style="color:#ae81ff">0.0f</span>, <span style="color:#ae81ff">0.0f</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.0f</span>, <span style="color:#ae81ff">1.0f</span>, <span style="color:#ae81ff">0.0f</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.0f</span>, <span style="color:#ae81ff">0.0f</span>, <span style="color:#ae81ff">1.0f</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Create and populate the buffer objects
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>GLuint vboHandles[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>glGenBuffers(<span style="color:#ae81ff">2</span>, vboHandles);
</span></span><span style="display:flex;"><span>GLuint positionBufferHandle <span style="color:#f92672">=</span> vboHandles[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>GLuint colorBufferHandle <span style="color:#f92672">=</span> vboHandles[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glBindBuffer(GL_ARRAY_BUFFER, positionBufferHandle);
</span></span><span style="display:flex;"><span>glBufferData(GL_ARRAY_BUFFER, <span style="color:#ae81ff">9</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">float</span>), positionData, GL_STATIC_DRAW);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glBindBuffer(GL_ARRAY_BUFFER, colorBufferHandle);
</span></span><span style="display:flex;"><span>glBufferData(GL_ARRAY_BUFFER, <span style="color:#ae81ff">9</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">float</span>), colorData, GL_STATIC_DRAW);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Create and set-up the vertex array object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>glGenVertexArrays(<span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>vaoHandle);
</span></span><span style="display:flex;"><span>glBindVertexArray(vaoHandle);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glEnableVertexAttribArray(<span style="color:#ae81ff">0</span>);  <span style="color:#75715e">// Vertex position
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>glEnableVertexAttribArray(<span style="color:#ae81ff">1</span>);  <span style="color:#75715e">// Vertex color
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//break current vertex array object binding.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>glBindBuffer(GL_ARRAY_BUFFER, positionBufferHandle);
</span></span><span style="display:flex;"><span>glVertexAttribPointer(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>, GL_FLOAT, GL_FALSE, <span style="color:#ae81ff">0</span>, (GLubyte <span style="color:#f92672">*</span>)NULL);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glBindBuffer(GL_ARRAY_BUFFER, colorBufferHandle);
</span></span><span style="display:flex;"><span>glVertexAttribPointer(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, GL_FLOAT, GL_FALSE, <span style="color:#ae81ff">0</span>, (GLubyte <span style="color:#f92672">*</span>)NULL);
</span></span><span style="display:flex;"><span>glBindVertexArray(<span style="color:#ae81ff">0</span>);
</span></span></code></pre></div><h5 id="多个program切换">多个Program切换</h5>
<p>可以在一个OpenGL程序中创建多个Program对象（<code>glCreateProgram</code>创建），然后通过<code>glUseProgram</code>且切换使用需要的Program对象。</p>
<h5 id="删除program对象">删除Program对象</h5>
<p>如果一个Program对象不再使用，可以使用<code>glDeleteProgram</code>删除；如果这个Program正在使用，使用<code>glDeleteProgram</code>不会直接删除，而是给一个删除标记，等到下次OpenGL内部检测时才会删除。<br>
删除一个Program对象后，会自动Detach之前Attach上去的所有ShaderObject（<code>glCreateShader</code>创建），但是不会删除这些ShaderObject，除非调用<code>glDeleteShader</code>。</p>
<h5 id="动态获取-vertex-input-attributes">动态获取 vertex input attributes</h5>
<p>一般情况下，vertex输入属性是在shader代码中定义好的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#f92672">#</span>version <span style="color:#ae81ff">410</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layout (location<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">in</span> vec3 VertexPosition;
</span></span><span style="display:flex;"><span>layout (location<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">in</span> vec3 VertexColor;
</span></span></code></pre></div><p>或者是在Program对象link之前（<code>glLinkProgram</code>），通过<code>glBindAttribLocation</code>来绑定索引：</p>
<pre><code>//programHandle是已经创建好的Program对象
glBindAttribLocation(programHandle, 0, &quot;VertexPosition&quot;);
glBindAttribLocation(programHandle, 1, &quot;VertexColor&quot;);
</code></pre>
<p>那么有没办法在Program对象Link之后，再去查询获取vertex attributes的location等信息？方式如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">//获取输入属性的个数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>GLint numAttribs;
</span></span><span style="display:flex;"><span>glGetProgramInterfaceiv(programHandle, GL_PROGRAM_INPUT, GL_ACTIVE_RESOURCES, <span style="color:#f92672">&amp;</span>numAttribs);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//获取每个输入属性的名字、类型、索引
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>GLenum properties[] <span style="color:#f92672">=</span> {GL_NAME_LENGTH, GL_TYPE, GL_LOCATION};
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;Active attributes:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> numAttribs; <span style="color:#f92672">++</span>i ) 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    GLint results[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>    glGetProgramResourceiv(programHhandle, GL_PROGRAM_INPUT, i, <span style="color:#ae81ff">3</span>, properties, <span style="color:#ae81ff">3</span>, NULL, results);
</span></span><span style="display:flex;"><span>    GLint nameBufSize <span style="color:#f92672">=</span> results[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> name <span style="color:#f92672">=</span> new <span style="color:#66d9ef">char</span>[nameBufSize];
</span></span><span style="display:flex;"><span>    glGetProgramResourceName(programHandle, GL_PROGRAM_INPUT, i, nameBufSize, NULL, name);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;%-5d %s (%s)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, results[<span style="color:#ae81ff">2</span>], name, getTypeString(results[<span style="color:#ae81ff">1</span>]));
</span></span><span style="display:flex;"><span>    delete [] name;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="alert warning ">
  <p>glGetProgramInterfaceiv、glGetProgramResourceiv、glGetProgramResourceName是OpenGL 4.3才提供的API。4.3之前的版本可以使用 glGetProgramiv、glGetActiveAttrib、glGetAttribLocation等接口来实现上述需求。</p>
</div>
<p>输出结果：</p>
<pre><code>Active attributes:
1    VertexColor (vec3)
0    VertexPosition (vec3)
</code></pre>
<h5 id="uniform-variables的意义和作用">Uniform variables的意义和作用</h5>
<p>前面介绍的 Vertex attributes 是一种通用的给 shader 填充输入参数的方式，Vertext attributes 在 shader 内部不仅可以被读取，还可以被修改。<br>
但是 Uniform variables 在 shader 内只能被读取，如果要修改，必须在 shader 之外调用OpenGL的API。</p>
<p>什么情况下用Uniform variable：<br>
在渲染一个模型时，由于其每个顶点(vertex)信息都不一样，所以每个顶点在调用 shader 时，shader 的输入参数都不一样，相当于每计算一个顶点，shader 的输入参数都得变化一次，针对这种实时变化的输入参数，最好使用 Vertex attributes ；对于像摄像机角度、投射变换(projective transformations)等数据，相对变化频率很低，这种情况下最好使用 Uniform variable，毕竟它在 shader 内为常量，所以编译器可以针对这种常量做优化来提升性能。</p>
<p>注意事项：<br>
Uniform variables 可以定义在任何一个 shader 中，如果多个 shader 定义了名字相同的 Uniform variables，那么它们的类型也必须相同，也就是说：<span class="highlight-text green">只要一处定义，就可以被当前程序的所有 shader 对象访问</span>。</p>
<h5 id="uniform-variables-常用的opengl-api">Uniform variables 常用的OpenGL API</h5>
<p>假设测试的 uniform.frag 代码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#f92672">#</span>version <span style="color:#ae81ff">410</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layout (location <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">in</span> vec3 VertexPosition;
</span></span><span style="display:flex;"><span>layout (location <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">in</span> vec3 VertexColor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>out vec3 Color;
</span></span><span style="display:flex;"><span>uniform mat4 RotationMatrix;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>void main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Color <span style="color:#f92672">=</span> VertexColor;
</span></span><span style="display:flex;"><span>    gl_Position <span style="color:#f92672">=</span> RotationMatrix <span style="color:#f92672">*</span> vec4(VertexPosition,<span style="color:#ae81ff">1.0</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>那么OpenGL API获取并设置Uniform variables的方式如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>rotationMatrix <span style="color:#f92672">=</span> glm<span style="color:#f92672">::</span>rotate(glm<span style="color:#f92672">::</span>mat4(<span style="color:#ae81ff">1.0f</span>), angle, vec3(<span style="color:#ae81ff">0.0f</span>,<span style="color:#ae81ff">0.0f</span>,<span style="color:#ae81ff">1.0f</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GLuint programHandle <span style="color:#f92672">=</span> prog.getHandle();
</span></span><span style="display:flex;"><span><span style="color:#75715e">//获取 Uniform variables 索引
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>GLuint location <span style="color:#f92672">=</span> glGetUniformLocation(programHandle, <span style="color:#e6db74">&#34;RotationMatrix&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//通过索引获取 Uniform variables 的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>glUniformMatrix4fv(location, <span style="color:#ae81ff">1</span>, GL_FALSE, <span style="color:#f92672">&amp;</span>rotationMatrix[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]);
</span></span></code></pre></div><p>常用技巧：</p>
<ul>
<li>
<p>如果要使用vec3作为 Uniform variables 类型，那么可以使用 <code>glUniform3f</code> 或者 <code>glUniform3fv</code>，<span class="highlight-text green"> 后缀带'v'的表示数组类型 </span>。</p>
</li>
<li>
<p>通过数组索引访问 Uniform variables ：</p>
<pre><code>  GLuint location = glGetUniformLocation( programHandle, &quot;MyArray[1]&quot; );
</code></pre>
</li>
<li>
<p>通过结构体成员变量访问 Uniform variables ：</p>
<pre><code>  GLuint location = glGetUniformLocation( programHandle, &quot;MyMatrices.Rotation&quot; );
</code></pre>
</li>
</ul>
<h5 id="动态获取-uniform-variables">动态获取 Uniform variables</h5>
<p>方式类似前面提到的<strong>动态获取 vertex input attributes</strong>，还是以前面的 uniform.frag 为例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>GLint numUniforms <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>glGetProgramInterfaceiv( handle, GL_UNIFORM, GL_ACTIVE_RESOURCES, <span style="color:#f92672">&amp;</span>numUniforms);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GLenum properties[] <span style="color:#f92672">=</span> {GL_NAME_LENGTH, GL_TYPE, GL_LOCATION, GL_BLOCK_INDEX};
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;Active uniforms:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> numUniforms; <span style="color:#f92672">++</span>i ) 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    GLint results[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>    glGetProgramResourceiv(handle, GL_UNIFORM, i, <span style="color:#ae81ff">4</span>, properties, <span style="color:#ae81ff">4</span>, NULL, results);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>( results[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;       <span style="color:#75715e">// Skip uniforms in blocks 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    GLint nameBufSize <span style="color:#f92672">=</span> results[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> name <span style="color:#f92672">=</span> new <span style="color:#66d9ef">char</span>[nameBufSize];
</span></span><span style="display:flex;"><span>    glGetProgramResourceName(handle, GL_UNIFORM, i, nameBufSize, NULL, name);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;%-5d %s (%s)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, results[<span style="color:#ae81ff">2</span>], name, getTypeString(results[<span style="color:#ae81ff">1</span>]));
</span></span><span style="display:flex;"><span>    delete [] name;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="alert warning ">
  <p>OpenGL 4.3 之前的版本，则要使用：glGetProgramiv、glGetActiveUniform、glGetUniformLocation、and glGetActiveUniformName.</p>
</div>
<p>打印结果：</p>
<pre><code>Active uniforms:
0    RotationMatrix (mat4)
</code></pre>
<h5 id="uniform-blocks意义和作用">Uniform blocks意义和作用</h5>
<p>如果你的 OpenGL 程序中有多个 shader 对象，且这些 shader 使用了同一个 Uniform variables，而我们知道，Uniform variables的location等信息是在 shader 对象Link之后生成的，也就是说每当 Link 一个 shader对象时，这个Uniform variables 的location 可能发生变化（比如在 shader 对象A中，Uniform variables 的location 为1，shader 对象2中，那么Uniform variables 的location 为2，那么如果先link对象A，再link对象B，则这个Uniform variables的location对于 shader 对象A就已失效）。<br>
所以需要一个管理当前Program对象中所有Uniform variables的管理器，这个管理器就是Uniform blocks。</p>
<p>使用实例：</p>
<p>以下代码是绘制一个同心圆渐变效果的 shader。</p>
<p>buniformblock.frag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#f92672">#</span>version <span style="color:#ae81ff">430</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layout (location <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">in</span> vec3 VertexPosition;
</span></span><span style="display:flex;"><span>layout (location <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">in</span> vec3 VertexTexCoord;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>out vec3 TexCoord;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>void main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    TexCoord <span style="color:#f92672">=</span> VertexTexCoord;
</span></span><span style="display:flex;"><span>    gl_Position <span style="color:#f92672">=</span> vec4(VertexPosition,<span style="color:#ae81ff">1.0</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>basic_uniformblock.vert:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#f92672">#</span>version <span style="color:#ae81ff">430</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">in</span> vec3 TexCoord;
</span></span><span style="display:flex;"><span>layout (location <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) out vec4 FragColor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layout (binding <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) uniform BlobSettings {
</span></span><span style="display:flex;"><span>  vec4 InnerColor;
</span></span><span style="display:flex;"><span>  vec4 OuterColor;
</span></span><span style="display:flex;"><span>  float RadiusInner;
</span></span><span style="display:flex;"><span>  float RadiusOuter;
</span></span><span style="display:flex;"><span>} Blob;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>void main() 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    float dx <span style="color:#f92672">=</span> TexCoord.x <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>    float dy <span style="color:#f92672">=</span> TexCoord.y <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>    float dist <span style="color:#f92672">=</span> sqrt(dx <span style="color:#f92672">*</span> dx <span style="color:#f92672">+</span> dy <span style="color:#f92672">*</span> dy);
</span></span><span style="display:flex;"><span>    FragColor <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>       mix( Blob.InnerColor, Blob.OuterColor,
</span></span><span style="display:flex;"><span>             smoothstep( Blob.RadiusInner, Blob.RadiusOuter, dist )
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>OpenGL API 代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>GLuint programHandle <span style="color:#f92672">=</span> prog.getHandle();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Get the index of the uniform block
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>GLuint blockIndex <span style="color:#f92672">=</span> glGetUniformBlockIndex(programHandle, <span style="color:#e6db74">&#34;BlobSettings&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Allocate space for the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>GLint blockSize;
</span></span><span style="display:flex;"><span>glGetActiveUniformBlockiv(programHandle, blockIndex,
</span></span><span style="display:flex;"><span>                          GL_UNIFORM_BLOCK_DATA_SIZE, <span style="color:#f92672">&amp;</span>blockSize);
</span></span><span style="display:flex;"><span>GLubyte <span style="color:#f92672">*</span> blockBuffer;
</span></span><span style="display:flex;"><span>blockBuffer <span style="color:#f92672">=</span> (GLubyte <span style="color:#f92672">*</span>) malloc(blockSize);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Query for the offsets of each block variable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> GLchar <span style="color:#f92672">*</span>names[] <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#34;BlobSettings.InnerColor&#34;</span>, <span style="color:#e6db74">&#34;BlobSettings.OuterColor&#34;</span>,
</span></span><span style="display:flex;"><span>                          <span style="color:#e6db74">&#34;BlobSettings.RadiusInner&#34;</span>, <span style="color:#e6db74">&#34;BlobSettings.RadiusOuter&#34;</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GLuint indices[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>glGetUniformIndices(programHandle, <span style="color:#ae81ff">4</span>, names, indices);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GLint offset[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>glGetActiveUniformsiv(programHandle, <span style="color:#ae81ff">4</span>, indices, GL_UNIFORM_OFFSET, offset);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Store data within the buffer at the appropriate offsets
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>GLfloat outerColor[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0.0f</span>, <span style="color:#ae81ff">0.0f</span>, <span style="color:#ae81ff">0.0f</span>, <span style="color:#ae81ff">0.0f</span>};
</span></span><span style="display:flex;"><span>GLfloat innerColor[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">1.0f</span>, <span style="color:#ae81ff">1.0f</span>, <span style="color:#ae81ff">0.75f</span>, <span style="color:#ae81ff">1.0f</span>};
</span></span><span style="display:flex;"><span>GLfloat innerRadius <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25f</span>, outerRadius <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.45f</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>memcpy(blockBuffer <span style="color:#f92672">+</span> offset[<span style="color:#ae81ff">0</span>], innerColor, <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(GLfloat));
</span></span><span style="display:flex;"><span>memcpy(blockBuffer <span style="color:#f92672">+</span> offset[<span style="color:#ae81ff">1</span>], outerColor, <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(GLfloat));
</span></span><span style="display:flex;"><span>memcpy(blockBuffer <span style="color:#f92672">+</span> offset[<span style="color:#ae81ff">2</span>], <span style="color:#f92672">&amp;</span>innerRadius, <span style="color:#66d9ef">sizeof</span>(GLfloat));
</span></span><span style="display:flex;"><span>memcpy(blockBuffer <span style="color:#f92672">+</span> offset[<span style="color:#ae81ff">3</span>], <span style="color:#f92672">&amp;</span>outerRadius, <span style="color:#66d9ef">sizeof</span>(GLfloat));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Create the buffer object and copy the data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>GLuint uboHandle;
</span></span><span style="display:flex;"><span>glGenBuffers( <span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>uboHandle );
</span></span><span style="display:flex;"><span>glBindBuffer( GL_UNIFORM_BUFFER, uboHandle );
</span></span><span style="display:flex;"><span>glBufferData( GL_UNIFORM_BUFFER, blockSize, blockBuffer, GL_DYNAMIC_DRAW );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Bind the buffer object to the uniform block
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>glBindBufferBase( GL_UNIFORM_BUFFER, <span style="color:#ae81ff">1</span>, uboHandle );
</span></span></code></pre></div><h5 id="glbufferdata的作用">glBufferData的作用</h5>
<p>Create the buffer object and copy the data into it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>GLuint uboHandle;
</span></span><span style="display:flex;"><span>glGenBuffers( <span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>uboHandle );
</span></span><span style="display:flex;"><span>glBindBuffer( GL_UNIFORM_BUFFER, uboHandle );
</span></span><span style="display:flex;"><span>glBufferData( GL_UNIFORM_BUFFER, blockSize, blockBuffer, GL_DYNAMIC_DRAW );
</span></span></code></pre></div><p>The space is allocated within the buffer object and the data is copied when glBufferData is called.</p>
<h5 id="glbindbufferbase的索引问题">glBindBufferBase的索引问题</h5>
<p>glBindBufferBase函数参数的索引（第二个参数）必须与定义uniform时设定的layout(binding=)相同，例如：</p>
<pre><code>glBindBufferBase(GL_UNIFORM_BUFFER, 0, uboHandle);
</code></pre>
<p>对应的uniform定义</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span>layout (binding <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">uniform</span> BlobSettings {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">vec4</span> InnerColor;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">vec4</span> OuterColor;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> RadiusInner;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> RadiusOuter;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h5 id="glbindbuffer与glbindbufferbase的区别">glBindBuffer与glBindBufferBase的区别</h5>
<div class="alert info ">
  <p>简述之：<code>glBindBuffer</code> 绑定的指针索引，是用来对 Buffer 填充或修改数据而使用的，但是这个索引无法作为输入参数传递给 shader ，如果要把这个索引传递给 shader ，那么必须使用glBindBufferBase。</p>
</div>
<p>书中原文：<br>
You might be wondering why we use glBindBuffer and glBindBufferBase with GL_UNIFORM_BUFFER. Aren&rsquo;t these the same binding points used in two different contexts? The answer is that the GL_UNIFORM_BUFFER point can be used in each function with a slightly different meaning. With glBindBuffer, we bind to a point that can be used for filling or modifying a buffer, but can&rsquo;t be used as a source of data for the shader. When we use glBindBufferBase, we are binding to an index within a location that can be directly sourced by the shader. Granted, that&rsquo;s a bit confusing.</p>
<h5 id="uniform-layout类型">uniform layout类型：</h5>
<ul>
<li>std140</li>
<li>shared</li>
<li>packed</li>
<li>row_major</li>
<li>column_major</li>
</ul>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span>layout( std140 ) <span style="color:#66d9ef">uniform</span> BlobSettings {
</span></span><span style="display:flex;"><span>    };
</span></span></code></pre></div><p>多个修饰符可以组合使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span>layout( row_major, shared ) <span style="color:#66d9ef">uniform</span> BlobSettings {
</span></span><span style="display:flex;"><span>    };
</span></span></code></pre></div><h5 id="fragment-shader到vertex-shader之间的工作流程page-58">fragment shader到vertex shader之间的工作流程（page 58）</h5>
<figure><img src="https://dawnarc.com/img/20170113-[Shading]OpenGL%e5%b8%b8%e7%94%a8%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86%28%e4%b8%aa%e4%ba%ba%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%29/[Shading]OpenGL%e5%b8%b8%e7%94%a8%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86%28%e4%b8%aa%e4%ba%ba%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%29-01.png"/>
</figure>

<p>Between the vertex and fragment shader, the vertices are assembled into primitives, clipping takes place, and the viewport transformation is applied (among other operations). The rasterization process then takes place and the polygon is filled (if necessary). The fragment shader is executed once for each fragment (pixel) of the polygon being rendered (typically in parallel). Data provided from the vertex shader is (by default) interpolated in a perspective correct manner, and provided to the fragment shader via shader input variables. The fragment shader determines the appropriate color for the pixel and sends it to the frame buffer using output variables. The depth information is handled automatically.</p>
<h5 id="attribute-vs-uniform-vs-varying">Attribute vs Uniform vs Varying</h5>
<ul>
<li>const – The declaration is of a compile time constant.</li>
<li>attribute – Global variables that may change per vertex, that are passed from the OpenGL application to vertex shaders. This qualifier can only be used in vertex shaders. For the shader this is a read-only variable. See Attribute section.</li>
<li>uniform – Global variables that may change per primitive [&hellip;], that are passed from the OpenGL application to the shaders. This qualifier can be used in both vertex and fragment shaders. For the shaders this is a read-only variable. See Uniform section.</li>
<li>varying – used for interpolated data between a vertex shader and a fragment shader. Available for writing in the vertex shader, and read-only in a fragment shader. See Varying section.</li>
</ul>
<p>Origin: differences between an attribute, a uniform, and a varying variable<br>
<a href="https://stackoverflow.com/a/17557438/1645289">https://stackoverflow.com/a/17557438/1645289</a></p>
<h5 id="opengl耗时较高的函数">OpenGL耗时较高的函数</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>glBufferData()
</span></span><span style="display:flex;"><span>glBufferSubData()
</span></span><span style="display:flex;"><span>glCompressedTexImage2D() <span style="color:#f92672">/</span> glCompressedTexImage3D()
</span></span><span style="display:flex;"><span>glCompressedTexSubImage2D() <span style="color:#f92672">/</span> glCompressedTexSubImage3D()
</span></span><span style="display:flex;"><span>glTexImage2D() <span style="color:#f92672">/</span> glTexImage3D()
</span></span><span style="display:flex;"><span>glTexSubImage2D() <span style="color:#f92672">/</span> glTexSubImage3D()
</span></span><span style="display:flex;"><span>glcompileshader() <span style="color:#f92672">/</span> glshadersource()
</span></span><span style="display:flex;"><span>gllinkprogram()
</span></span></code></pre></div><h5 id="如何限制帧率">如何限制帧率</h5>
<p>你写一个简单的hello triangle，GPU占用接近100%，大概率是没有限制刷新率（即没有开启垂直同步VSync）。<br>
在<code>glfwMakeContextCurrent(wnd);</code>之后追加<code>glfwSwapInterval(1)</code>:</p>
<ul>
<li><code>glfwSwapInterval(1)</code> : the application should run at &lt;= refresh rate (display hardware).</li>
<li><code>glfwSwapInterval(0)</code> : the application can run at any rate, and should run faster than with <code>glfwSwapInterval(1)</code>.</li>
</ul>
<div class="alert warning ">
  <p>Windows下若启用了DWM(Desktop Window Manager, also named Desktop Composition)，此时使用<code>glfwSwapInterval(1)</code>开启VSync无效。<br>
解决办法：<br>
GLFW提供了cmake的define编译选项<code>GLFW_USE_DWM_SWAP_INTERVAL</code>，表示即使使用DWM或Windows Aero，也强制开启VSync。</p>
</div>
<p>Origin:<br>
<a href="https://discourse.glfw.org/t/i-have-a-question-about-fps/1498">https://discourse.glfw.org/t/i-have-a-question-about-fps/1498</a><br>
<a href="https://stackoverflow.com/a/16303811/1645289">https://stackoverflow.com/a/16303811/1645289</a></p>
<h5 id="gl_position-homogeneous-coordinates">gl_Position (Homogeneous coordinates)</h5>
<p>What can I do with the 4th component of gl_Position?<br>
<a href="https://gamedev.stackexchange.com/a/153137/117871">https://gamedev.stackexchange.com/a/153137/117871</a></p>
<h5 id="如何通过uv获取纹理采样中的像素">如何通过UV获取纹理采样中的像素</h5>
<p>vertex shader</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-TS" data-lang="TS"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">version</span> <span style="color:#ae81ff">330</span> <span style="color:#a6e22e">core</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">layout</span> (<span style="color:#a6e22e">location</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">vec3</span> <span style="color:#a6e22e">aPos</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">layout</span> (<span style="color:#a6e22e">location</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">vec3</span> <span style="color:#a6e22e">aColor</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">layout</span> (<span style="color:#a6e22e">location</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">vec2</span> <span style="color:#a6e22e">aTexCoord</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">out</span> <span style="color:#a6e22e">vec3</span> <span style="color:#a6e22e">ourColor</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">out</span> <span style="color:#a6e22e">vec2</span> <span style="color:#a6e22e">TexCoord</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl_Position</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vec4</span>(<span style="color:#a6e22e">aPos</span>, <span style="color:#ae81ff">1.0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ourColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aColor</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">TexCoord</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aTexCoord</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>pixel shader</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-TS" data-lang="TS"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">version</span> <span style="color:#ae81ff">330</span> <span style="color:#a6e22e">core</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">out</span> <span style="color:#a6e22e">vec4</span> <span style="color:#a6e22e">FragColor</span>;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">in</span> <span style="color:#a6e22e">vec3</span> <span style="color:#a6e22e">ourColor</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">in</span> <span style="color:#a6e22e">vec2</span> <span style="color:#a6e22e">TexCoord</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">uniform</span> <span style="color:#a6e22e">sampler2D</span> <span style="color:#a6e22e">ourTexture</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">FragColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">texture</span>(<span style="color:#a6e22e">ourTexture</span>, <span style="color:#a6e22e">TexCoord</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Origin: Texture
<a href="https://learnopengl.com/Getting-started/Textures">https://learnopengl.com/Getting-started/Textures</a></p>
<h5 id="layered-rendering-layered-images">Layered rendering (Layered Images)</h5>
<p>AMD RGP统计数据有个叫<code>Shaded GS primitives</code>的属性，其统计来源自cube-based shadow mapping（比如point light的shadow map），而cube-based shadow mapping是通过Layered rendering来实现。</p>
<p>Layered rendering<br>
<a href="https://www.khronos.org/opengl/wiki/Geometry_Shader#Layered_rendering">https://www.khronos.org/opengl/wiki/Geometry_Shader#Layered_rendering</a></p>
<p>Layered Images<br>
<a href="https://www.khronos.org/opengl/wiki/Framebuffer_Object#Layered_Images">https://www.khronos.org/opengl/wiki/Framebuffer_Object#Layered_Images</a></p>
<hr>
<p><code>莫道不消魂？帘卷西风，人比黄花瘦。---李清照《醉花阴》</code></p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://dawnarc.com/tags/graphics/">Graphics</a>

  <a class="tag tag--primary tag--small" href="https://dawnarc.com/tags/opengl/">OpenGL</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2017/01/zbrush%E5%85%B3%E4%BA%8E%E7%BC%A9%E6%94%BE%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/" data-tooltip="[ZBrush]关于缩放的三种方式">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2017/01/zbrush%E5%B8%B8%E7%94%A8%E7%AC%94%E5%88%B7brush/" data-tooltip="[ZBrush]常用笔刷(brush)">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            <script src="https://utteranc.es/client.js"
  repo="dawnarc/dawnarc.github.io"
  issue-term="pathname"
  label="Comment"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2024 Wang Aiguo. All Rights Reserved. Powered by <A href="https://gohugo.io/"> Hugo</A> | Theme <A href="https://github.com/kakawait/hugo-tranquilpeak-theme/">Tranquilpeak</A>.
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2017/01/zbrush%E5%85%B3%E4%BA%8E%E7%BC%A9%E6%94%BE%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/" data-tooltip="[ZBrush]关于缩放的三种方式">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2017/01/zbrush%E5%B8%B8%E7%94%A8%E7%AC%94%E5%88%B7brush/" data-tooltip="[ZBrush]常用笔刷(brush)">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Wang Aiguo</h4>
    
      <div id="about-card-bio">白金翰大堂经理</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Developer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Yichang, Hubei
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('https://dawnarc.com/images/cover-v1.2.0.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

	<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/school-book.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://dawnarc.com/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
  document.querySelectorAll('pre code').forEach((el) => {
    hljs.highlightElement(el);
  });
});
</script>


  
    
  






    
  </body>
</html>

