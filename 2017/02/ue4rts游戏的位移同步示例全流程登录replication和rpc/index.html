

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.42.1 with theme Tranquilpeak 0.4.3-BETA">
    <title>[UE4]RTS游戏的位移同步示例全流程(登录、Replication和RPC)</title>
    <meta name="author" content="Neil Wang">
    <meta name="keywords" content="">

    <link rel="icon" href="https://dawnarc.com/favicon.png">
    

    
    <meta name="description" content="转载请注明原文出处：http://www.dawnarc.com
keywords：UE4、Replication、Relicate、reliable、RPC、RTS Movement、Dedicated Server、属性同步、demo、example
实例的完整工程下载地址见文章底部
属性同步 步骤：
1，对属性添加UPROPERTY(Replicated)宏：
//Player display name UPROPERTY(Replicated) FString Alias_;  2，属性所在的class中重写函数GetLifetimeReplicatedProps：
需要头文件：
#include &quot;Net/UnrealNetwork.h&quot;  重写函数：
void AReplTestCharacter::GetLifetimeReplicatedProps(TArray&lt; FLifetimeProperty &gt; &amp; OutLifetimeProps) const { Super::GetLifetimeReplicatedProps(OutLifetimeProps); DOREPLIFETIME(AReplTestCharacter, Alias_); }  RPC（远程执行调用） 步骤：
1，对需要远程执行的函数添加宏UFUNCTION(Server, Reliable, WithValidation)或者UFUNCTION(Client, Reliable)。其中Server表示在客户端调用，在服务端执行，Client则反之；WithValidation表示是否需要验证函数，加上的画需要添加函数：bool MyFun_Validate()，函数提内容写在MyFun_Implementation函数内。cpp中不需要与函数名同名的函数体，只需要实现_Validate和_Implementation两个函数即可。 头文件：
//移动角色(只在服务端执行的函数) UFUNCTION(Server, Reliable, WithValidation) void ServerMoveToDest(APawn* Panw, const FVector DestLocation); bool ServerMoveToDest_Validate(APawn* Panw, const FVector DestLocation); void ServerMoveToDest_Implementation(APawn* Panw, const FVector DestLocation);  CPP：
bool AReplTestPlayerController::ServerMoveToDest_Validate(APawn* Panw, const FVector DestLocation) { return true; } void AReplTestPlayerController::ServerMoveToDest_Implementation(APawn* Pawn, const FVector DestLocation) { //logic.">
    <meta property="og:description" content="转载请注明原文出处：http://www.dawnarc.com
keywords：UE4、Replication、Relicate、reliable、RPC、RTS Movement、Dedicated Server、属性同步、demo、example
实例的完整工程下载地址见文章底部
属性同步 步骤：
1，对属性添加UPROPERTY(Replicated)宏：
//Player display name UPROPERTY(Replicated) FString Alias_;  2，属性所在的class中重写函数GetLifetimeReplicatedProps：
需要头文件：
#include &quot;Net/UnrealNetwork.h&quot;  重写函数：
void AReplTestCharacter::GetLifetimeReplicatedProps(TArray&lt; FLifetimeProperty &gt; &amp; OutLifetimeProps) const { Super::GetLifetimeReplicatedProps(OutLifetimeProps); DOREPLIFETIME(AReplTestCharacter, Alias_); }  RPC（远程执行调用） 步骤：
1，对需要远程执行的函数添加宏UFUNCTION(Server, Reliable, WithValidation)或者UFUNCTION(Client, Reliable)。其中Server表示在客户端调用，在服务端执行，Client则反之；WithValidation表示是否需要验证函数，加上的画需要添加函数：bool MyFun_Validate()，函数提内容写在MyFun_Implementation函数内。cpp中不需要与函数名同名的函数体，只需要实现_Validate和_Implementation两个函数即可。 头文件：
//移动角色(只在服务端执行的函数) UFUNCTION(Server, Reliable, WithValidation) void ServerMoveToDest(APawn* Panw, const FVector DestLocation); bool ServerMoveToDest_Validate(APawn* Panw, const FVector DestLocation); void ServerMoveToDest_Implementation(APawn* Panw, const FVector DestLocation);  CPP：
bool AReplTestPlayerController::ServerMoveToDest_Validate(APawn* Panw, const FVector DestLocation) { return true; } void AReplTestPlayerController::ServerMoveToDest_Implementation(APawn* Pawn, const FVector DestLocation) { //logic.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="[UE4]RTS游戏的位移同步示例全流程(登录、Replication和RPC)">
    <meta property="og:url" content="/2017/02/ue4rts%E6%B8%B8%E6%88%8F%E7%9A%84%E4%BD%8D%E7%A7%BB%E5%90%8C%E6%AD%A5%E7%A4%BA%E4%BE%8B%E5%85%A8%E6%B5%81%E7%A8%8B%E7%99%BB%E5%BD%95replication%E5%92%8Crpc/">
    <meta property="og:site_name" content="玄冬Wong">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="玄冬Wong">
    <meta name="twitter:description" content="转载请注明原文出处：http://www.dawnarc.com
keywords：UE4、Replication、Relicate、reliable、RPC、RTS Movement、Dedicated Server、属性同步、demo、example
实例的完整工程下载地址见文章底部
属性同步 步骤：
1，对属性添加UPROPERTY(Replicated)宏：
//Player display name UPROPERTY(Replicated) FString Alias_;  2，属性所在的class中重写函数GetLifetimeReplicatedProps：
需要头文件：
#include &quot;Net/UnrealNetwork.h&quot;  重写函数：
void AReplTestCharacter::GetLifetimeReplicatedProps(TArray&lt; FLifetimeProperty &gt; &amp; OutLifetimeProps) const { Super::GetLifetimeReplicatedProps(OutLifetimeProps); DOREPLIFETIME(AReplTestCharacter, Alias_); }  RPC（远程执行调用） 步骤：
1，对需要远程执行的函数添加宏UFUNCTION(Server, Reliable, WithValidation)或者UFUNCTION(Client, Reliable)。其中Server表示在客户端调用，在服务端执行，Client则反之；WithValidation表示是否需要验证函数，加上的画需要添加函数：bool MyFun_Validate()，函数提内容写在MyFun_Implementation函数内。cpp中不需要与函数名同名的函数体，只需要实现_Validate和_Implementation两个函数即可。 头文件：
//移动角色(只在服务端执行的函数) UFUNCTION(Server, Reliable, WithValidation) void ServerMoveToDest(APawn* Panw, const FVector DestLocation); bool ServerMoveToDest_Validate(APawn* Panw, const FVector DestLocation); void ServerMoveToDest_Implementation(APawn* Panw, const FVector DestLocation);  CPP：
bool AReplTestPlayerController::ServerMoveToDest_Validate(APawn* Panw, const FVector DestLocation) { return true; } void AReplTestPlayerController::ServerMoveToDest_Implementation(APawn* Pawn, const FVector DestLocation) { //logic.">
    
      <meta name="twitter:creator" content="@idealsland">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=640">
    

    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://dawnarc.com/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-light.min.css">
      
    

    
      
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-78064851-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://dawnarc.com/">玄冬Wong</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://dawnarc.com/#about">
    
    
    
      
        <img class="header-picture" src="//www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
  
  

</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://dawnarc.com/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Neil Wang</h4>
        
          <h5 class="sidebar-profile-bio">久长唯有品格</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://dawnarc.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/1645289/protoss" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.artstation.com/artist/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-artstation"></i>
      
      <span class="sidebar-button-desc">ArtStation</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.facebook.com/koanland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-facebook"></i>
      
      <span class="sidebar-button-desc">Facebook</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/dawnarc/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
      
      <span class="sidebar-button-desc">Linkedin</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.pinterest.com/wangaiguo/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-pinterest"></i>
      
      <span class="sidebar-button-desc">Pinterest</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://steamcommunity.com/id/dawnarc" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-steam"></i>
      
      <span class="sidebar-button-desc">Steam</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/idealsland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://weibo.com/koanland" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-weibo"></i>
      
      <span class="sidebar-button-desc">Weibo</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      [UE4]RTS游戏的位移同步示例全流程(登录、Replication和RPC)
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2017-02-25T20:33:40&#43;08:00">
        
  February 25, 2017

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://dawnarc.com/categories/unrealengine4">UnrealEngine4</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              

<p>转载请注明原文出处：<a href="http://www.dawnarc.com">http://www.dawnarc.com</a></p>

<p>keywords：UE4、Replication、Relicate、reliable、RPC、RTS Movement、Dedicated Server、属性同步、demo、example</p>

<p>实例的完整工程下载地址见文章底部</p>

<h5 id="属性同步">属性同步</h5>

<p>步骤：<br />
1，对属性添加UPROPERTY(Replicated)宏：</p>

<pre><code>//Player display name
UPROPERTY(Replicated)
    FString Alias_;
</code></pre>

<p>2，属性所在的class中重写函数GetLifetimeReplicatedProps：<br />
需要头文件：</p>

<pre><code>#include &quot;Net/UnrealNetwork.h&quot;
</code></pre>

<p>重写函数：</p>

<pre><code>void AReplTestCharacter::GetLifetimeReplicatedProps(TArray&lt; FLifetimeProperty &gt; &amp; OutLifetimeProps) const
{
    Super::GetLifetimeReplicatedProps(OutLifetimeProps);

    DOREPLIFETIME(AReplTestCharacter, Alias_);
}
</code></pre>

<h5 id="rpc-远程执行调用">RPC（远程执行调用）</h5>

<p>步骤：<br />
1，对需要远程执行的函数添加宏UFUNCTION(Server, Reliable, WithValidation)或者UFUNCTION(Client, Reliable)。其中Server表示在客户端调用，在服务端执行，Client则反之；WithValidation表示是否需要验证函数，加上的画需要添加函数：bool MyFun_Validate()，函数提内容写在MyFun_Implementation函数内。cpp中不需要与函数名同名的函数体，只需要实现_Validate和_Implementation两个函数即可。
头文件：</p>

<pre><code>//移动角色(只在服务端执行的函数)
UFUNCTION(Server, Reliable, WithValidation)
    void ServerMoveToDest(APawn* Panw, const FVector DestLocation);
bool ServerMoveToDest_Validate(APawn* Panw, const FVector DestLocation);
void ServerMoveToDest_Implementation(APawn* Panw, const FVector DestLocation);
</code></pre>

<p>CPP：</p>

<pre><code>bool AReplTestPlayerController::ServerMoveToDest_Validate(APawn* Panw, const FVector DestLocation)
{
    return true;
}

void AReplTestPlayerController::ServerMoveToDest_Implementation(APawn* Pawn, const FVector DestLocation)
{
    //logic...
}
</code></pre>

<h5 id="角色身上需要设置的属性">角色身上需要设置的属性</h5>

<p>
<figure>
    
        <img src="https://dawnarc.com/img/20170225-[UE4]RTS%e6%b8%b8%e6%88%8f%e7%9a%84%e4%bd%8d%e7%a7%bb%e5%90%8c%e6%ad%a5%e7%a4%ba%e4%be%8b%ef%bc%88Replication%e5%92%8cRPC%ef%bc%89/[UE4]RTS%e6%b8%b8%e6%88%8f%e7%9a%84%e4%bd%8d%e7%a7%bb%e5%90%8c%e6%ad%a5%e7%a4%ba%e4%be%8b%ef%bc%88Replication%e5%92%8cRPC%ef%bc%89-01.jpg" />
    
    
</figure>

角色蓝图上的这几个属性默认是勾选的。如果是C++，对应的属性名也是这几个。</p>

<p>登陆界面：

<figure>
    
        <img src="https://dawnarc.com/img/20170225-[UE4]RTS%e6%b8%b8%e6%88%8f%e7%9a%84%e4%bd%8d%e7%a7%bb%e5%90%8c%e6%ad%a5%e7%a4%ba%e4%be%8b%ef%bc%88Replication%e5%92%8cRPC%ef%bc%89/[UE4]RTS%e6%b8%b8%e6%88%8f%e7%9a%84%e4%bd%8d%e7%a7%bb%e5%90%8c%e6%ad%a5%e7%a4%ba%e4%be%8b%ef%bc%88Replication%e5%92%8cRPC%ef%bc%89-02.jpg" />
    
    
</figure>
</p>

<p>多个客户端连上服务端的最终情景：

<figure>
    
        <img src="https://dawnarc.com/img/20170225-[UE4]RTS%e6%b8%b8%e6%88%8f%e7%9a%84%e4%bd%8d%e7%a7%bb%e5%90%8c%e6%ad%a5%e7%a4%ba%e4%be%8b%ef%bc%88Replication%e5%92%8cRPC%ef%bc%89/[UE4]RTS%e6%b8%b8%e6%88%8f%e7%9a%84%e4%bd%8d%e7%a7%bb%e5%90%8c%e6%ad%a5%e7%a4%ba%e4%be%8b%ef%bc%88Replication%e5%92%8cRPC%ef%bc%89-03.jpg" />
    
    
</figure>
</p>

<h4 id="同步相关的基础概念">同步相关的基础概念</h4>

<h5 id="netmode">NetMode</h5>

<p>每个Actor有个接口：AActor::GetNetMode()，返回值意思如下：</p>

<ul>
<li>NM_Standalone：表示当前Actor在独立服务器（单机模式），可以执行客户端、服务端的所有功能。</li>
<li>NM_DedicatedServer：表示当前Actor在专用服务器上，只能执行服务端相关的功能。</li>
<li>NM_ListenServer：官方文档上解释的很少，我在官方论坛上问了下得到的几个解释是，<font color=red>ListenServer可以被游戏内的某个玩家的机器当作服务器，该服务器拥有操作每个客户端角色的权利。这种模式下，更方便来创建服务器；缺点是承载人数较少。</font>个人理解是ListenServer可能更适合做局域网游戏，因为这种既不需要考虑外挂也不需要考虑承载压力。</li>
</ul>

<p><font color=red>DedicatedServer没有客户端的相关功能，只接收远程客户端的网络请求，适合承载大规模玩家在线。</font>另外连接DedicatedServer的客户端，是没有权限直接修改其他玩家的数据，因为客户端上的大部分Object的Role枚举都是ROLE_AutonomousProxy（如果你逻辑有bug，也是可以被客户端发送非法请求串改其他角色的数据，所以这里所说的没有权限修改，不要以为DedicatedServer可以帮你反外挂），但是在ListenServer的玩家主机上可以，因为他拥有其他所有玩家的实例（Role枚都是ROLE_Authority类型）。UE4的一些API内部有权限检测的逻辑：判断当前Role类型是否为ROLE_Authority，这样避免非法修改数据。</p>

<h5 id="role">Role</h5>

<p>每个Actor有个公开属性：AActor::Role。表示当前Actor的作用权限，枚举值有：</p>

<ul>
<li>ROLE_SimulatedProxy：表示当前Actor是一个模拟服务端的Actor状态Object，无法修改服务端上的数据，也没有权限执行远程函数（Reliable标识的UFUNCTION）。DedicatedServer服务器中创建的对象，都是ROLE_Authority，这些对象映射在客户端上的对象则都是ROLE_SimulatedProxy。</li>
<li>ROLE_AutonomousProxy：与ROLE_SimulatedProxy相似，区别是ROLE_AutonomousProxy有权限执行远程函数，但是远程函数必须是该Object身上的，其他Object上的远程函数没有权限执行。</li>
<li>ROLE_Authority：最高权限，即可以修改Server上的属性，又可以执行任何Objecct身上的远程函数。Standalone服务器中，所有对象都是ROLE_Authority。</li>
</ul>

<h5 id="关键函数">关键函数</h5>

<p>1，客户端登陆</p>

<pre><code>void UMyUserWidget::OnBtnLoginClick()
{
    if (APlayerController* PC = GetWorld()-&gt;GetFirstPlayerController())
    {
        FString URL = FString::Printf(TEXT(&quot;%s:%s?Alias=%s&quot;), *(TxtServerIP-&gt;GetText().ToString()), *(TxtServerPort-&gt;GetText().ToString()), *(TxtUsername-&gt;GetText().ToString()));
        PC-&gt;ClientTravel(*URL, TRAVEL_Absolute);
    }
}
</code></pre>

<p>2，GameMode::InitNewPlayer()，处理登陆请求时的自定义参数，比如账号名和密码。</p>

<pre><code>FString AReplTestGameMode::InitNewPlayer(APlayerController* NewPlayerController, const FUniqueNetIdRepl&amp; UniqueId, const FString&amp; Options, const FString&amp; Portal)
{
    FString Rs = Super::InitNewPlayer(NewPlayerController, UniqueId, Options, Portal);
    if (AReplTestPlayerController* RTPC = Cast&lt;AReplTestPlayerController&gt;(NewPlayerController))
    {
        FString Alias = UGameplayStatics::ParseOption(Options, TEXT(&quot;Alias&quot;)).Trim();
        if (Alias.Len() == 0 || AliasMap.Find(Alias))
        {
            return Rs;
        }

        RTPC-&gt;SetPlayerAlias(Alias);

        PlayerData Data;
        Data.Alias = Alias;
        AliasMap.Add(Alias, Data);
    }

    return Rs;
}
</code></pre>

<p>3，GameMode::PostLogin()，登陆完成后的回调函数，创建角色可以放在这个函数中处理。</p>

<pre><code>void AReplTestGameMode::PostLogin(APlayerController* NewPlayer)
{
    Super::PostLogin(NewPlayer);

    if (GetNetMode() == NM_DedicatedServer)
    {
        PlayerCount++;
        if (CharClass)
        {
            if (AReplTestCharacter* Player = GetWorld()-&gt;SpawnActor&lt;AReplTestCharacter&gt;(CharClass, SpawnLoc, SpawnRot))
            {
                PlayerList.Add(Player);

                /*if (AMyAIController* AIC = GetWorld()-&gt;SpawnActor&lt;AMyAIController&gt;(SpawnLoc, SpawnRot))
                {
                    AIC-&gt;Possess(Player);
                }*/

                Player-&gt;SpawnDefaultController();

                //设置角色的显示名称
                if (AReplTestPlayerController* RTPC = Cast&lt;AReplTestPlayerController&gt;(NewPlayer))
                {
                    if (PlayerData* Data = AliasMap.Find(RTPC-&gt;PlayerAlias()))
                    {
                        Player-&gt;SetAlias(*(Data-&gt;Alias));
                        Data-&gt;RTC = Player;

                        if (AMyAIController* AIC = Cast&lt;AMyAIController&gt;(Player-&gt;GetController()))
                        {
                            AIC-&gt;SetPlayerAlias(Data-&gt;Alias);
                        }
                    }
                }
            }
        }
    }
}
</code></pre>

<p>4，Character::BeginPlay()，当创建的Character进入场景时的回调函数，绑定摄像机的逻辑可以放在这个函数中</p>

<pre><code>void AReplTestCharacter::BeginPlay()
{
    Super::BeginPlay();
    if (ROLE_SimulatedProxy == Role &amp;&amp; NM_Client == GetNetMode())
    {
        if (APlayerController* PC = GetWorld()-&gt;GetFirstPlayerController())
        {
            if (AReplTestPlayerController* RTPC = Cast&lt;AReplTestPlayerController&gt;(PC))
            {
                //因为一个客户端首次加载时会有多个玩家的角色进入场景，这里判断哪个角色才是当前客户端的
                if (Alias_ == RTPC-&gt;PlayerAlias())
                {
                    PC-&gt;SetViewTarget(this);
                    RTPC-&gt;SetSimulatedCharacter(this);
                }
            }
        }
    }
}
</code></pre>

<p>5，客户端判断鼠标点击事件，这里加了一个保护，如果鼠标前后两次点击的坐标距离相差小于120，则不向服务端发送位移请求，防止频繁点击时发送消息太频繁。</p>

<pre><code>void AReplTestPlayerController::MoveToMouseCursor()
{
    // Trace to see what is under the mouse cursor
    FHitResult Hit;
    GetHitResultUnderCursor(ECC_Visibility, false, Hit);

    if (Hit.bBlockingHit)
    {
        if (FVector::Dist(LastDestLoc, Hit.ImpactPoint) &gt; 120)
        {
            LastDestLoc = Hit.ImpactPoint;
            SetNewMoveDestination(Hit.ImpactPoint);
        }
    }
}
</code></pre>

<p>6，服务端处理Move请求的函数，ServerMoveToDest_Validate判断请求的逻辑是否合法：Pawn是不是当前客户端操控的角色，防止操控其他玩家的角色。</p>

<pre><code>bool AReplTestPlayerController::ServerMoveToDest_Validate(APawn* Pawn, const FVector DestLocation)
{
    //判断请求是否非法，不允许当前客户端操控其他客户端的角色
    bool Rs = false;
    if (AReplTestCharacter* RTC = Cast&lt;AReplTestCharacter&gt;(Pawn))
    {
        Rs = RTC-&gt;Alias() == PlayerAlias();
    }
    return Rs;
}

void AReplTestPlayerController::ServerMoveToDest_Implementation(APawn* Pawn, const FVector DestLocation)
{
    if (AMyAIController* AIC = Cast&lt;AMyAIController&gt;(Pawn-&gt;GetController()))
    {
        AIC-&gt;MoveToLocation(DestLocation);
    }
}
</code></pre>

<h5 id="注意事项">注意事项：</h5>

<p>1，Replicated属性只能在服务端修改<br />
Replicated属性只允许服务端修改后通知客户端，而不允许客户端修改Replicated属性后通知到服务端。
参考：Only the server can replicate variables or multicast events to all clients<br />
<a href="https://answers.unrealengine.com/questions/459423/change-variable-in-client-want-server-to-see-it-bu.html">https://answers.unrealengine.com/questions/459423/change-variable-in-client-want-server-to-see-it-bu.html</a></p>

<p>2，Server或者Client函数参数只能时指针或者引用，而不能是对象<br />
比如如果参数是FString，那么必须是引用：const FString&amp; Str，而不能是FString对象。</p>

<p>3，HUD的构造函数在服务端也会执行，但是DrawHUD()函数不会在服务端执行。
也就是说你要在HUD中判断当前程序是客户端还是服务端，可以不用考虑DrawHUD()函数。</p>

<p>4，当客户端登陆成功后，客户端所有的对象都会被重置，登陆前设置的对数属性值将变为默认值。<br />
比如在启动游戏后登陆之前，你给PlayerController上的string属性设置为&rdquo;abc&rdquo;，那么登陆成功后，这个属性值就变成了空字符串。</p>

<p>5，GameMode、AIController是为服务端设计的，PlayerController是为客户端设计的。两者虽然在客户端和服务端都可访问，但是前者是在服务端创建的，后者是在客户端创建的，比如PlayerController::GetHitResultAtScreenPosition只在客户端生效，而GameMode::PostLogin()只在服务端生效。</p>

<p>6，服务端的AIController::MoveToLocation()的效果相当于客户端UNavigationSystem::SimpleMoveToLocation()。AIController::MoveToLocation()内部有去调用NavigationSystem相关的接口。</p>

<p>7，客户端的PlayerController可以不用Possess玩家角色，因为客户端相关数据都是以服务端为准，操作角色也是在服务端完成，一般只需要对该角色绑定摄像机即可。</p>

<p>8，如果_Validate()函数返回false，则服务器会会认为客户端非法，并主动断开该客户端。断开客户端时服务端会打印：</p>

<pre><code>LogRep: Error: ReceivedRPC: RPC_GetLastFailedReason: XXXX_Validate
LogNet: Error: UActorChannel::ProcessBunch: Replicator.ReceivedBunch failed.  Closing connection. RepObj: ReplTestPlayerController /Game/TopDownCPP/Maps/TopDownExampleMap.TopDownExampleMap:PersistentLevel.ReplTestPlayerController_1, Channel: 2
</code></pre>

<p>9，当前客户端只能获取当前控制角色的Controller，无法获取其他客户端的Controller，比如玩家A在玩家B的角色为C1，那么调用C1-&gt;GetController()时返回NULL。</p>

<p>10，动画同步<br />
角色X在客户端A播放一个攻击动作，并且角色X在客户端B的视野内，此时需要客户端B也能同步看到角色X的动画，流程如下：<br />
<span class="highlight-text primary">
客户端发送请求 -》 服务端执行函数（假设叫ServerPlayAnim()） -》 ServerPlayAnim函数内调用NetMulticast函数 -》 NetMulticast函数内执行播放动画的逻辑。
</span></p>

<h5 id="常见问题">常见问题：</h5>

<ol>
<li><p>如果出现以下错误，表示Reliable函数的参数名和引擎生成的代码有同名的情况，把参数名重新改一下即可。</p>

<p>error : Function parameter: &lsquo;Pawn&rsquo; cannot be defined in &lsquo;ServerMoveToDest&rsquo; as it is already defined in scope &lsquo;Controller&rsquo; (shadowing is not allowed)</p></li>

<li><p>如果服务端SpawnActor时返回NULL，且参数传递都正确，可能是服务端上的对应Actor未清理，比如客户端崩掉了，导致了服务端的Actor未即时清理。</p></li>

<li><p>执行UNavigationSystem::SimpleMoveToLocation(MyCharacter()-&gt;GetController(), Location);时位移无效（假设已经生成了NavMesh）。原因是MyCharacter是在客户端生成的，客户端PlayerController传递给NavigationSystem()时执行无效，需要在服务端Spawn这个Character，然后再给其Spawn出一个AIController并Possess。官方模版项目，传递给NavigationSystem的是PlayerController且位移有效，是因为模版项目中设置的DefautlPawnClass，其实是服务端Spawn出来的Character，执行位置也是在服务端。</p></li>

<li><p>在打包版本下，客户端的玩家行走时，摄像机有抖动和卡顿（编辑器模式下正常），原因是没有勾选SpringArmComponent的Lag属性：Enable Camera Lag、Enable Camera Rotation Lag

<figure>
    
        <img src="https://dawnarc.com/img/20170225-[UE4]RTS%e6%b8%b8%e6%88%8f%e7%9a%84%e4%bd%8d%e7%a7%bb%e5%90%8c%e6%ad%a5%e7%a4%ba%e4%be%8b%ef%bc%88Replication%e5%92%8cRPC%ef%bc%89/[UE4]RTS%e6%b8%b8%e6%88%8f%e7%9a%84%e4%bd%8d%e7%a7%bb%e5%90%8c%e6%ad%a5%e7%a4%ba%e4%be%8b%ef%bc%88Replication%e5%92%8cRPC%ef%bc%89-04.jpg" />
    
    
</figure>

Dedicated Servers, Jitter, Matchmaking<br />
<a href="https://forums.unrealengine.com/development-discussion/c-gameplay-programming/96598-dedicated-servers-jitter-matchmaking">https://forums.unrealengine.com/development-discussion/c-gameplay-programming/96598-dedicated-servers-jitter-matchmaking</a></p></li>
</ol>

<p>示例工程下载地址：<br />
<a href="http://pan.baidu.com/s/1o7MzmRo">http://pan.baidu.com/s/1o7MzmRo</a></p>

<p>其他参考文章：<br />
属性同步：<br />
<a href="http://blog.csdn.net/yangxuan0261/article/details/54766955">http://blog.csdn.net/yangxuan0261/article/details/54766955</a><br />
RPC：<br />
<a href="http://blog.csdn.net/yangxuan0261/article/details/54766951">http://blog.csdn.net/yangxuan0261/article/details/54766951</a></p>

<hr />

<p><code>天下事，成于精而败于众，立于诚而倾于奢。</code></p>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://dawnarc.com/tags/ue4/">UE4</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2017/02/ue4%E6%89%93%E5%BC%80url%E9%93%BE%E6%8E%A5/" data-tooltip="[UE4]打开URL链接">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2017/02/ue4%E5%A6%82%E4%BD%95%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2%E7%8B%AC%E7%AB%8B%E4%B8%93%E7%94%A8%E6%9C%8D%E5%8A%A1%E7%AB%AFstandalone-dedicated-server/" data-tooltip="[UE4]如何编译部署独立专用服务端(Standalone Dedicated Server)">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Neil Wang. All Rights Reserved. Powered by <A href="https://gohugo.io/"> Hugo</A>.
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2017/02/ue4%E6%89%93%E5%BC%80url%E9%93%BE%E6%8E%A5/" data-tooltip="[UE4]打开URL链接">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://dawnarc.com/2017/02/ue4%E5%A6%82%E4%BD%95%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2%E7%8B%AC%E7%AB%8B%E4%B8%93%E7%94%A8%E6%9C%8D%E5%8A%A1%E7%AB%AFstandalone-dedicated-server/" data-tooltip="[UE4]如何编译部署独立专用服务端(Standalone Dedicated Server)">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/0df91cdac5811a56ca485b0449d91b5e?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Neil Wang</h4>
    
      <div id="about-card-bio">久长唯有品格</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Marvelous Developer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Yichang·Hubei
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://dawnarc.com/2018/07/c--c--11-shared_ptr-%E4%B8%8E-weak_ptr-%E5%8C%BA%E5%88%AB/">
                <h3 class="media-heading">[C&#43;&#43;]C&#43;&#43;11 shared_ptr 与 weak_ptr 区别</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">shared_ptr 语法：
#include &lt;memory&gt; shared_ptr&lt;A&gt; x(new A);  shared_ptr 相当于 对象引用计数器。每当对 shared_ptr 赋值操作一次，则其引用对象的计数+1。当某对象的引用计数为0时，则该对象自动销毁。
weak_ptr 语法：
#include &lt;memory&gt; weak_ptr&lt;A&gt; x(new A);  weak_ptr 典型应用是缓存：例如我们在缓存中存放了一个 raw pointer 来指向某个对象，如果这个对象在其他地方被销毁了，那么缓存中的这个 raw pointer 指向的对象不存在。如果我们希望某个对象在其他地方被销毁时，缓存中指向该对象的指针也马上被置为 null，那么就可以使用 weak_ptr。
参考自：
shared_ptr and weak_ptr differences
https://stackoverflow.com/questions/4984381/shared-ptr-and-weak-ptr-differences
When is std::weak_ptr useful?
https://stackoverflow.com/questions/12030650/when-is-stdweak-ptr-useful</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://dawnarc.com/2018/07/ue4-tsharedptr-%E4%B8%8E-tweakobjectptr-%E5%8C%BA%E5%88%AB/">
                <h3 class="media-heading">[UE4] TSharedPtr 与 TWeakObjectPtr 区别</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">UE4 的 TSharedPtr、TWeakObjectPtr 模仿自 C++11 的 shared_ptr 、 weak_ptr 。
TSharedPtr TSharedPtr 相当于对象的引用计数器。每当对 TSharedPtr 赋值一次，该 TSharedPtr 引用对象计数加一，当引用计数为0时，则该对象被自动销毁。TSharedPtr 可以防止对象被垃圾回收，等价于 UPROPERTY() （前提是 TSharedPtr 成员变量所属的对象没有被销毁，如果被销毁，则 TSharedPtr 成员变量的计数不再有效）。
用法：
 TSharedPtr&lt;MyUObject&gt; ObjPtr = MakeShareable(NewObject&lt;MyUObject&gt;());  如果两个 TSharedPtr 相互赋值，则会导致对象永不释放，导致内存泄漏。
 TWeakObjectPtr TWeakObjectPtr 保持的对象不能防止被垃圾回收。若引用的对象在其他地方被销毁，则 TWeakObjectPtr 内部的指针自动将被置为NULL，TWeakObjectPtr::IsValid()会返回false。TSharedPtr 则没有这个作用。
用法：
 TWeakObjectPtr&lt;MyUObject&gt; ObjPtr = NewObject&lt;MyUObject&gt;();  参考资料：
There&rsquo;s a Huge Difference, One Will Always Crash
https://answers.unrealengine.com/questions/48818/whats-the-difference-between-using-tweakobjectptr.html
what is a &ldquo;weak object pointer&rdquo;?
https://answers.unrealengine.com/questions/201186/what-is-a-weak-object-pointer.html</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://dawnarc.com/2018/07/ue4error-c3668-utexturecubeupdateresourcew/">
                <h3 class="media-heading">[UE4]error C3668: &#39;UTextureCube::UpdateResourceW&#39;</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">4.19 编译错误：
2&gt;F:\EpicGames\UE_4.19\Engine\Source\Runtime\Engine\Classes\Engine/TextureCube.h(69): error C3668: 'UTextureCube::UpdateResourceW': method with override specifier 'override' did not override any base class methods 2&gt;F:\EpicGames\UE_4.19\Engine\Source\Runtime\Engine\Classes\Engine/CanvasRenderTarget2D.h(43): error C3668: 'UCanvasRenderTarget2D::UpdateResourceW': method with override specifier 'override' did not override any base class methods  4.18 编译错误：
2&gt;f:\epicgames\ue_4.18\engine\source\runtime\core\public\HAL/ThreadSafeCounter64.h(67): error C2039: '_InterlockedIncrement': is not a member of 'FWindowsPlatformAtomics' 2&gt;F:\EpicGames\UE_4.18\Engine\Source\Runtime\Core\Public\Windows/WindowsPlatformAtomics.h(14): note: see declaration of 'FWindowsPlatformAtomics' 2&gt;f:\epicgames\ue_4.18\engine\source\runtime\core\public\HAL/ThreadSafeCounter64.h(67): error C2665: '_InterlockedIncrement': none of the 4 overloads could convert all the argument types 2&gt;C:\Program Files (x86)\Windows Kits\8.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://dawnarc.com/2018/06/c--non-static-member-function-as-callback-function-and-achieve-inheritance/">
                <h3 class="media-heading">[C&#43;&#43;]non-static member function as callback function and achieve inheritance</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">keywords：C++ 非静态成员函数作为回调函数并实现继承多态
Base.hpp
#pragma once class Base { public: virtual void TestFun1(int Param) {} virtual void TestFun2(int Param) {} };  Child.hpp
#pragma once #include &lt;iostream&gt; #include &quot;Base.hpp&quot; class Child : public Base { public: void TestFun1(int Param) override { printf(&quot;Fun1 : %d\n&quot;, Param); } void TestFun2(int Param) override { printf(&quot;Fun2 : %d\n&quot;, Param); } };  EventManager.h
// Fill out your copyright notice in the Description page of Project Settings.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://dawnarc.com/2018/06/c--how-to-erase-an-element-from-std-vector-by-index/">
                <h3 class="media-heading">[C&#43;&#43;]How to erase an element from std vector by index</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">keywords：C++ 用索引删除 std::vector 中的数组元素
To delete a single element, you could do:
std::vector&lt;int&gt; vec; vec.push_back(6); vec.push_back(-17); vec.push_back(12); // Deletes the second element (vec[1]) vec.erase(vec.begin() + 1);  Or, to delete more than one element at once:
// Deletes the second through third elements (vec[1], vec[2]) vec.erase(vec.begin() + 1, vec.begin() + 3);  参考自：How do I erase an element from std::vector&lt;&gt; by index?
https://stackoverflow.com/questions/875103/how-do-i-erase-an-element-from-stdvector-by-index
无论精神多么独立的人，感情却总是在寻找一种依附，寻找一种归宿。---路遥《平凡的世界》</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://dawnarc.com/2018/06/versioncontrolgit-reset-type/">
                <h3 class="media-heading">[VersionControl]git Reset Type</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">概述 Reset Type有三种类型：Soft、Mixed、Hard。
理解Reset Type之前，先解释下以下术语：
 HEAD 这是当前分支版本顶端的别名，也就是在当前分支你最近的一个提交 Index Index也被称为staging area，是指一整套即将被下一个提交的文件集合。他也是将成为HEAD的父亲的那个commit Working Directory 代表你正在工作的那个文件集，又称作Working Tree。  三个Reset级别的意思分别是：
 Soft # 还原 HEAD Mixed # 还原 HEAD、Index # 默认参数 Hard # 还原 HEAD、Index、Working Directory  应用 如果本地有commit，但是没有push，此时想把这个commit 回退掉，则：右键需要回退的SHA-1 -》 Reset &ldquo;master&rdquo; to this。   然后和弹出菜单：   选择合适的Reset Type，点击OK。
注意事项：
根据需要选择Reset Type：
 若本地无修改，那么就选择 Soft; 若本地有修改未commit，那么就选择 Mixed; 若本地有修改且已commit，那么就选择 Hard;  参考自：git reset soft,hard,mixed之区别深解
https://www.cnblogs.com/kidsitcn/p/4513297.html
生命的价值不在于时间的长短，而在于你如何利用它。</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://dawnarc.com/2018/06/versioncontrolorig_head-fetch_head-merge_head%E5%8C%BA%E5%88%AB/">
                <h3 class="media-heading">[VersionControl]ORIG_HEAD, FETCH_HEAD, MERGE_HEAD区别</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">区别：
 HEAD: The current ref that you’re looking at. In most cases it’s probably refs/heads/master
 FETCH_HEAD: The SHAs of branch/remote heads that were updated during the last git fetch
 ORIG_HEAD: When doing a merge, this is the SHA of the branch you’re merging into.
 MERGE_HEAD: When doing a merge, this is the SHA of the branch you’re merging from.
 CHERRY_PICK_HEAD: When doing a cherry-pick, this is the SHA of the commit which you are cherry-picking.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://dawnarc.com/2018/06/shadingflatgouraudphong-shading%E7%9A%84%E5%B7%AE%E5%88%A5/">
                <h3 class="media-heading">[Shading]Flat、Gouraud、Phong Shading的差別</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">keywords：Comparison flat, Gouraud, Phong shading
原文：
https://cg2010studio.com/2011/11/01/flat%E3%80%81gouraud%E3%80%81phong-shading%E7%9A%84%E5%B7%AE%E5%88%A5-comparison-flat-gouraud-phong-shading/
现今多边形的著色方法基本的有这三种：flat、Gouraud、Phong Shading，它们之间有何差别呢？喜欢玩游戏的人一定要知道Gouraud Shading，这是PC最常使用的著色法，因为效能好、效果还不错。而近年来，随着GPU快速的发展，Phong Shading逐渐应用在更真实的著色上。
从一张图可以看出他们的各自的特色：（a: Flat→b: Gouraud→c: Phong）
  从古早到现代：Flat→Gouraud→Phong Shading。
从简单到复杂：Flat→Gouraud→Phong Shading。
观察三者所呈现的效果，可以归纳出下列结论：
 平面着色：恒定的表面着色 Gouraud着色：颜色插值着色 Phong着色：顶点法线插值着色  用简单的中文来解释原理：
 flat shading：三角形的顶点没有法向量，三角形整个面才有法向量，打光时整个三角形只呈现一种颜色。 Gouraud shading：三角形的顶点都有各自的法向量，打光时三个顶点有各自的颜色，接着做双线性内插（bilinear interpolation）来求得颜色，使整个三角形有渐层的颜色变化。 Phong shading：三角形的顶点都有各自的法向量，先对三角形整个面作法向量的双线性内插，接着打光来求整个三角形的颜色。  然后我们来分析各自的复杂度：
假设三角形面积为 A 。三角形个数为 N 。而且我们知道打一次光需要6次乘法和2次加法和1次查表的运算，此设定为 L 。双线性内插设定为 B 。
 flat shading的复杂度：N * L Gouraud shading 的复杂度：N * (3 * L + b * A) Phong shading的复杂度：(B + L) * N * A  数学好的人很容易计算出复杂度：Flat &lt; Gouraud &lt; Phong Shading。这里也因此说明了为何早期电脑都只支援Gouraud shading，就算已经知道Phong shading的效果比Gouraud shading好，但还是选择效能好而效果不错的Gouraud shading！如今GPU发展迅速，Phong Shading的效能已得到提升。   stack overflow答案 https://computergraphics.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://dawnarc.com/2018/06/openglrendering-pipeline%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF%E6%B5%81%E7%A8%8B%E6%A6%82%E8%BF%B0/">
                <h3 class="media-heading">[OpenGL]Rendering Pipeline(渲染管线)流程概述</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Pipeline    (The blue boxes are programmable shader stages.)
The OpenGL rendering pipeline works in the following order:
 Prepare vertex array data, and then render it Vertex Processing:  Each vertex is acted upon by a Vertex Shader. Each vertex in the stream is processed in turn into an output vertex. Optional primitive tessellation stages. Optional Geometry Shader primitive processing. The output is a sequence of primitives.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://dawnarc.com/2018/06/dlangc--%E7%9B%B8%E5%AF%B9d%E7%9A%84%E4%BC%98%E7%82%B9/">
                <h3 class="media-heading">[Dlang]C&#43;&#43;相对D的优点</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">原文：What does C++ do better than D?
https://softwareengineering.stackexchange.com/questions/97207/what-does-c-do-better-than-d
Most of the things C++ &ldquo;does&rdquo; better than D are meta things:
C++ has better compilers, better tools, more mature libraries, more bindings, more experts, more tutorials etc. Basically it has more and better of all the external things that you would expect from a more mature language. This is inarguable.
As for the language itself, there are a few things that C++ does better than D in my opinion.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         409 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://dawnarc.com/images/cover-v1.2.0.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://dawnarc.com/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/dawnarc.com\/2017\/02\/ue4rts%E6%B8%B8%E6%88%8F%E7%9A%84%E4%BD%8D%E7%A7%BB%E5%90%8C%E6%AD%A5%E7%A4%BA%E4%BE%8B%E5%85%A8%E6%B5%81%E7%A8%8B%E7%99%BB%E5%BD%95replication%E5%92%8Crpc\/';
          
            this.page.identifier = '\/2017\/02\/ue4rts%E6%B8%B8%E6%88%8F%E7%9A%84%E4%BD%8D%E7%A7%BB%E5%90%8C%E6%AD%A5%E7%A4%BA%E4%BE%8B%E5%85%A8%E6%B5%81%E7%A8%8B%E7%99%BB%E5%BD%95replication%E5%92%8Crpc\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'dawnarc';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

